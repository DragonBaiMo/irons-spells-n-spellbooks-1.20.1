# é“é­”æ³• Mod - å‚æ•°åŒ–æ–½æ³•ç³»ç»Ÿæ”¹é€ æ–¹æ¡ˆ

**é¡¹ç›®åç§°**: Iron's Spells 'n Spellbooks - Parameterized Spell Casting System
**Minecraft ç‰ˆæœ¬**: 1.20.1 Forge
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**ç¼–å†™æ—¥æœŸ**: 2025-10-31
**ä½œè€…**: BaiMo_

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [éœ€æ±‚åˆ†æ](#2-éœ€æ±‚åˆ†æ)
3. [æ¶æ„è®¾è®¡](#3-æ¶æ„è®¾è®¡)
4. [è¯¦ç»†å®æ–½è®¡åˆ’](#4-è¯¦ç»†å®æ–½è®¡åˆ’)
5. [å…³é”®æŠ€æœ¯å®ç°](#5-å…³é”®æŠ€æœ¯å®ç°)
6. [ä½¿ç”¨æ–‡æ¡£](#6-ä½¿ç”¨æ–‡æ¡£)
7. [æµ‹è¯•è®¡åˆ’](#7-æµ‹è¯•è®¡åˆ’)
8. [æ„å»ºä¸éƒ¨ç½²](#8-æ„å»ºä¸éƒ¨ç½²)
9. [é£é™©è¯„ä¼°ä¸ç¼“è§£](#9-é£é™©è¯„ä¼°ä¸ç¼“è§£)
10. [åç»­æ‰©å±•è®¡åˆ’](#10-åç»­æ‰©å±•è®¡åˆ’)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

Iron's Spells 'n Spellbooks æ˜¯ä¸€ä¸ªä¼˜ç§€çš„é­”æ³•ç³»ç»Ÿ Modï¼Œæ‹¥æœ‰ 90+ æŠ€èƒ½å’Œå®Œæ•´çš„æ–½æ³•æœºåˆ¶ã€‚å½“å‰ç‰ˆæœ¬çš„æ–½æ³•ç³»ç»Ÿä¸»è¦é€šè¿‡ç©å®¶æŒ‰é”®äº¤äº’è§¦å‘ï¼Œå‚æ•°å›ºå®šç”±æŠ€èƒ½å†…éƒ¨è®¡ç®—ã€‚æœ¬é¡¹ç›®æ—¨åœ¨æ‰©å±•è¯¥ç³»ç»Ÿï¼Œä½¿å…¶æ”¯æŒé€šè¿‡æŒ‡ä»¤åŒ–æ–¹å¼æ–½æ³•ï¼Œå¹¶å…è®¸é€šè¿‡ JSON å‚æ•°ç²¾ç¡®æ§åˆ¶æŠ€èƒ½æ•ˆæœã€ç›®æ ‡ã€è¡Œä¸ºç­‰ã€‚

### 1.2 åŒè½¨åˆ¶è®¾è®¡ç†å¿µ â­æ ¸å¿ƒâ­

æœ¬é¡¹ç›®é‡‡ç”¨**æ—è·¯è®¾è®¡ï¼ˆBypass Designï¼‰**ï¼Œåœ¨ä¸ä¿®æ”¹ä»»ä½•ç°æœ‰ä»£ç çš„å‰æä¸‹ï¼Œä¸ºç®¡ç†å‘˜æä¾›å‚æ•°åŒ–æ–½æ³•èƒ½åŠ›ï¼š

#### ğŸ”µ ç©å®¶æ–½æ³•é€šé“ï¼ˆåŸæœ‰ï¼Œé›¶ä¿®æ”¹ï¼‰

ç©å®¶ä½¿ç”¨å·è½´ã€æ³•æœ¯ä¹¦ã€é™„é­”æ­¦å™¨æ–½æ³•æ—¶ï¼Œ**ä»ç„¶å®Œå…¨å—åˆ°é…ç½®æ–‡ä»¶çš„é™åˆ¶**ï¼ˆæœ€å¤§ç­‰çº§ã€ä¼¤å®³å€ç‡ã€å†·å´æ—¶é—´ç­‰ï¼‰ï¼Œç¡®ä¿æ¸¸æˆå¹³è¡¡æ€§ä¸å—ä»»ä½•å½±å“ã€‚

```
ç©å®¶å³é”®å·è½´/æ³•æœ¯ä¹¦
    â†“
AbstractSpell.attemptInitiateCast() [åŸæœ‰æ–¹æ³•ï¼Œä¸ä¿®æ”¹]
    â†“
âœ“ æ£€æŸ¥é­”æ³•å€¼
âœ“ æ£€æŸ¥å†·å´
âœ“ æ£€æŸ¥é…ç½®é™åˆ¶ï¼ˆServerConfigsï¼‰
    â†“
AbstractSpell.onCast() [åŸæœ‰æ–¹æ³•ï¼Œä¸ä¿®æ”¹]
    â†“
ä½¿ç”¨é…ç½®çš„å‚æ•°ï¼Œå—é…ç½®ç³»ç»Ÿé™åˆ¶
```

#### ğŸŸ¢ ç®¡ç†å‘˜æ–½æ³•é€šé“ï¼ˆæ–°å¢ï¼Œæ—è·¯è®¾è®¡ï¼‰

ç®¡ç†å‘˜é€šè¿‡ `/cast` æŒ‡ä»¤ + JSON å‚æ•°æ–½æ³•æ—¶ï¼Œ**å¯ä»¥å®Œå…¨è‡ªå®šä¹‰æŠ€èƒ½æ•ˆæœã€è·³è¿‡é­”æ³•æ¶ˆè€—å’Œå†·å´é™åˆ¶**ï¼Œå®ç°ç‰¹æ®Šç©æ³•å’Œè°ƒè¯•éœ€æ±‚ã€‚

```
ç®¡ç†å‘˜æ‰§è¡Œ /cast æŒ‡ä»¤ + JSONå‚æ•°
    â†“
SpellCastManager.castSpell() [æ–°å¢æ—è·¯å…¥å£]
    â†“
âœ— è·³è¿‡é­”æ³•å€¼æ£€æŸ¥
âœ— è·³è¿‡å†·å´æ£€æŸ¥
âœ— è·³è¿‡é…ç½®é™åˆ¶
    â†“
IParameterizedSpell.onCastWithParameters() [æ–°å¢æ–¹æ³•]
    â†“
ä½¿ç”¨JSONå‚æ•°ï¼Œæ— è§†é…ç½®é™åˆ¶ï¼Œå®Œå…¨è‡ªç”±
```

**å…³é”®ä¿è¯**ï¼š
- âœ… **é…ç½®ç³»ç»Ÿå®Œå…¨ä¸åŠ¨** - ServerConfigsã€SpellConfigParameters ç­‰æ‰€æœ‰é…ç½®ä»£ç é›¶ä¿®æ”¹
- âœ… **ç©å®¶ä½“éªŒä¸å—å½±å“** - å·è½´ã€æ³•æœ¯ä¹¦ä»ç„¶å—é…ç½®é™åˆ¶
- âœ… **ç®¡ç†å‘˜æ‹¥æœ‰å®Œå…¨æ§åˆ¶** - é€šè¿‡å‚æ•°å¯å®ç°ä»»æ„æ•ˆæœ
- âœ… **ä¸¤æ¡é€šé“å®Œå…¨éš”ç¦»** - äº’ä¸å¹²æ‰°ï¼Œå„å¸å…¶èŒ

### 1.3 æ”¹é€ ç›®æ ‡

1. **æ—è·¯æŒ‡ä»¤é€šé“**: æ–°å¢ç®¡ç†å‘˜ä¸“ç”¨çš„å‚æ•°åŒ–æ–½æ³•æ¥å£ï¼Œä¸è§¦ç¢°åŸæœ‰ä»£ç 
2. **é›¶ä¾µå…¥è®¾è®¡**: ä¿æŒæ‰€æœ‰ç°æœ‰ä»£ç å’Œé…ç½®ç³»ç»Ÿ100%ä¸å˜
3. **å¯é€‰å®ç°**: æŠ€èƒ½å¯é€‰æ‹©æ€§æ”¯æŒå‚æ•°åŒ–ï¼ˆå®ç°IParameterizedSpellæ¥å£ï¼‰ï¼Œæ¸è¿›å¼æ”¹é€ 
4. **æ™ºèƒ½ç±»å‹è½¬æ¢**: è‡ªåŠ¨è¯†åˆ«JSONå‚æ•°ç±»å‹ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€Vec3ç­‰ï¼‰ï¼Œå®¹é”™å¤„ç†
5. **å®Œå…¨è‡ªç”±æ§åˆ¶**: ç®¡ç†å‘˜å¯æ— è§†é…ç½®é™åˆ¶ï¼Œå®ç°ä»»æ„æ•ˆæœï¼ˆä¼¤å®³ã€èŒƒå›´ã€å†·å´ç­‰ï¼‰

### 1.4 æ ¸å¿ƒä»·å€¼

- **æœåŠ¡å™¨ç®¡ç†å·¥å…·**: è…ç«¹å¯é€šè¿‡æŒ‡ä»¤ç²¾ç¡®æ§åˆ¶æŠ€èƒ½ï¼Œå®ç°PVPç«æŠ€åœºã€ä»»åŠ¡ç³»ç»Ÿç­‰ç‰¹æ®Šç©æ³•
- **è°ƒè¯•å¼€å‘å·¥å…·**: å¿«é€Ÿæµ‹è¯•æŠ€èƒ½æ•ˆæœï¼Œæ— éœ€æ‰‹åŠ¨å‡†å¤‡é­”æ³•å€¼ã€ç­‰çº§ç­‰ç¯å¢ƒ
- **æ•°æ®åŒ…æ‰©å±•**: é€šè¿‡Functionè°ƒç”¨ï¼Œå®ç°è„šæœ¬åŒ–çš„å¤æ‚é­”æ³•é€»è¾‘
- **å¹³è¡¡æ€§ä¿éšœ**: ç©å®¶æ–½æ³•ä»å—é…ç½®é™åˆ¶ï¼Œä¸å½±å“æ¸¸æˆå¹³è¡¡ï¼Œç®¡ç†å‘˜é€šé“ä»…ä¾›è…ç«¹ä½¿ç”¨

---

## 2. éœ€æ±‚åˆ†æ

### 2.1 åŠŸèƒ½éœ€æ±‚

#### FR-1: æ‰©å±• /cast æŒ‡ä»¤
**ä¼˜å…ˆçº§**: P0
**æè¿°**: åœ¨ç°æœ‰ `/cast` æŒ‡ä»¤åŸºç¡€ä¸Šæ·»åŠ å¯é€‰çš„ JSON å‚æ•°æ”¯æŒ

**æŒ‡ä»¤æ ¼å¼**:
```bash
/cast <casters> <spell> [level] [json]
```

**ç¤ºä¾‹**:
```bash
# åŸæœ‰æ ¼å¼ï¼ˆå®Œå…¨å…¼å®¹ï¼‰
/cast @s firebolt 5

# æ–°å¢ JSON å‚æ•°
/cast @s firebolt 5 {"damage": 100.0, "fireTime": 10}

# ç›®æ ‡æŒ‡å®š
/cast @s heal 3 {"target": "uuid-here", "healAmount": 50.0}

# è¡Œä¸ºæ§åˆ¶
/cast @s fireball 10 {"consumeMana": false, "triggerCooldown": false}
```

#### FR-2: å‚æ•°å®šä¹‰ä¸æ™ºèƒ½ç±»å‹è½¬æ¢ â­é‡ç‚¹â­
**ä¼˜å…ˆçº§**: P0
**æè¿°**: æŠ€èƒ½å¯å£°æ˜æ”¯æŒçš„å‚æ•°åŠå…¶ç±»å‹ã€å¿…å¡«æ€§ã€é»˜è®¤å€¼ï¼Œç³»ç»Ÿæä¾›æ™ºèƒ½ç±»å‹è½¬æ¢

**å‚æ•°ç±»å‹æ”¯æŒ**:
- æ•°å€¼ç±»å‹: `INT`, `FLOAT`, `DOUBLE` (è‡ªåŠ¨ç›¸äº’è½¬æ¢)
- å­—ç¬¦ä¸²ç±»å‹: `STRING`, `UUID` (è‡ªåŠ¨è¯†åˆ«UUIDæ ¼å¼)
- åæ ‡ç±»å‹: `VEC3` (JSONæ•°ç»„è‡ªåŠ¨è§£æä¸ºVec3å¯¹è±¡: `[x, y, z]`)
- å®ä½“é€‰æ‹©å™¨: `ENTITY_SELECTOR`
- å¸ƒå°”ç±»å‹: `BOOLEAN`
- ç»´åº¦ç±»å‹: `DIMENSION` (å¦‚: `"minecraft:the_nether"`)

**æ™ºèƒ½ç±»å‹è½¬æ¢æœºåˆ¶**:
```json
// ç”¨æˆ·è¾“å…¥ï¼š{"damage": 100}
// ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«ï¼š
//   - æ•´æ•° 100 â†’ å¯ç”¨ä½œ int/float/doubleï¼ˆè‡ªåŠ¨è½¬æ¢ï¼‰
//   - å°æ•° 100.5 â†’ å¯ç”¨ä½œ float/double
//   - "100" â†’ å­—ç¬¦ä¸²ï¼Œä½†å¯å°è¯•è½¬æ•°å­—
//   - [100, 64, 200] â†’ è‡ªåŠ¨è§£æä¸º Vec3(100, 64, 200)
```

**æ ¡éªŒç­–ç•¥ï¼ˆç®€åŒ–ï¼‰**:
- âœ… **ç±»å‹æ ¡éªŒ**: åŸºç¡€ç±»å‹æ£€æŸ¥ï¼ˆé˜²æ­¢ç¨‹åºå´©æºƒï¼‰
- âœ… **å¿…å¡«å‚æ•°**: æŠ€èƒ½å£°æ˜ä¸º `required` çš„å‚æ•°å¿…é¡»å­˜åœ¨
- âœ… **è‡ªåŠ¨è½¬æ¢**: æ•°å­—ç±»å‹å®½å®¹è½¬æ¢ï¼ˆint â†” float â†” doubleï¼‰
- âŒ **ä¸é™åˆ¶å€¼åŸŸ**: ç®¡ç†å‘˜å¯è®¾ç½®ä»»æ„æ•°å€¼ï¼ˆå¦‚ä¼¤å®³9999ã€èŒƒå›´1000ç­‰ï¼‰ï¼Œæ— ä¸Šé™

#### FR-3: æ–½æ³•è¡Œä¸ºæ§åˆ¶
**ä¼˜å…ˆçº§**: P1
**æè¿°**: é€šè¿‡å‚æ•°æ§åˆ¶æ–½æ³•è¿‡ç¨‹çš„å…³é”®è¡Œä¸º

**æ”¯æŒçš„è¡Œä¸ºå¼€å…³**:
```json
{
  "consumeMana": false,        // æ˜¯å¦æ¶ˆè€—é­”æ³•å€¼
  "triggerCooldown": false,    // æ˜¯å¦è§¦å‘å†·å´
  "playEffects": true,         // æ˜¯å¦æ’­æ”¾ç‰¹æ•ˆ
  "bypassConditions": false,   // æ˜¯å¦è·³è¿‡å‰ç½®æ¡ä»¶æ£€æŸ¥
  "showCastBar": true          // æ˜¯å¦æ˜¾ç¤ºæ–½æ³•è¿›åº¦æ¡
}
```

#### FR-4: ç›®æ ‡æŒ‡å®š
**ä¼˜å…ˆçº§**: P0
**æè¿°**: å…è®¸é€šè¿‡å‚æ•°ç›´æ¥æŒ‡å®šç›®æ ‡ï¼Œè·³è¿‡åŸæœ‰çš„ç›®æ ‡æ£€æµ‹é€»è¾‘

**ç›®æ ‡æŒ‡å®šæ–¹å¼**:
```json
{
  "target": "uuid-here",                    // UUID æŒ‡å®š
  "targetPos": [100, 64, 200],              // åæ ‡æŒ‡å®š
  "targets": ["uuid1", "uuid2", "uuid3"]    // å¤šç›®æ ‡
}
```

#### FR-5: æŠ€èƒ½æ•ˆæœå‚æ•°è¦†ç›–
**ä¼˜å…ˆçº§**: P0
**æè¿°**: å…è®¸é€šè¿‡å‚æ•°è¦†ç›–æŠ€èƒ½çš„é»˜è®¤æ•°å€¼è®¡ç®—

**ç¤ºä¾‹å‚æ•°**:
```json
{
  "damage": 100.0,           // ä¼¤å®³è¦†ç›–ï¼ˆFireboltï¼‰
  "healAmount": 50.0,        // æ²»ç–—é‡è¦†ç›–ï¼ˆHealï¼‰
  "duration": 600,           // æŒç»­æ—¶é—´ï¼ˆRootï¼‰
  "range": 20.0,             // ä½œç”¨èŒƒå›´ï¼ˆAOE æŠ€èƒ½ï¼‰
  "fireTime": 10             // ç‡ƒçƒ§æ—¶é—´ï¼ˆFireboltï¼‰
}
```

#### FR-6: æ–‡æ¡£ç”Ÿæˆç³»ç»Ÿ
**ä¼˜å…ˆçº§**: P1
**æè¿°**: è‡ªåŠ¨æ‰«ææ‰€æœ‰æŠ€èƒ½çš„å‚æ•°å®šä¹‰ï¼Œç”Ÿæˆå®Œæ•´æ–‡æ¡£

**æ–‡æ¡£æ ¼å¼**:
- JSON æ ¼å¼: ä¾›ç¨‹åºè¯»å–
- Markdown æ ¼å¼: ä¾›äººç±»é˜…è¯»

**æ–‡æ¡£å†…å®¹**:
- æŠ€èƒ½åŸºæœ¬ä¿¡æ¯ï¼ˆIDã€åç§°ã€å­¦æ´¾ã€ç­‰çº§èŒƒå›´ï¼‰
- æ”¯æŒçš„å‚æ•°åˆ—è¡¨ï¼ˆåç§°ã€ç±»å‹ã€å¿…å¡«æ€§ã€é»˜è®¤å€¼ã€è¯´æ˜ï¼‰
- ä½¿ç”¨ç¤ºä¾‹

#### FR-7: æ–‡æ¡£æŸ¥è¯¢æŒ‡ä»¤
**ä¼˜å…ˆçº§**: P2
**æè¿°**: æä¾›æ¸¸æˆå†…æŒ‡ä»¤æŸ¥è¯¢æŠ€èƒ½å‚æ•°æ–‡æ¡£

**æŒ‡ä»¤æ ¼å¼**:
```bash
/iss spells list                  # åˆ—å‡ºæ‰€æœ‰æŠ€èƒ½
/iss spells doc <spellId>         # æ˜¾ç¤ºæŠ€èƒ½å‚æ•°æ–‡æ¡£
/iss spells export [path]         # å¯¼å‡ºæ–‡æ¡£åˆ°æ–‡ä»¶
```

### 2.2 éåŠŸèƒ½éœ€æ±‚

#### NFR-1: æ€§èƒ½
- JSON è§£æå¼€é”€ < 1ms
- å‚æ•°æ ¡éªŒå¼€é”€ < 0.5ms
- ä¸å½±å“åŸæœ‰æ–½æ³•æ€§èƒ½ï¼ˆåŒè½¨åˆ¶éš”ç¦»ï¼‰

#### NFR-2: å…¼å®¹æ€§ï¼ˆé›¶ä¾µå…¥è®¾è®¡ï¼‰ â­æ ¸å¿ƒä¿è¯â­
- **é›¶ä¿®æ”¹æ‰¿è¯º**: ä¸ä¿®æ”¹ä»»ä½•ç°æœ‰çš„AbstractSpellä»£ç 
- **é…ç½®ç³»ç»Ÿä¿ç•™**: ServerConfigsã€SpellConfigParametersç­‰å®Œå…¨ä¸åŠ¨
- **åŒé€šé“éš”ç¦»**: ç©å®¶æ–½æ³•èµ°åŸé€šé“ï¼ˆå—é…ç½®é™åˆ¶ï¼‰ï¼Œç®¡ç†å‘˜æ–½æ³•èµ°æ–°é€šé“ï¼ˆæ— é™åˆ¶ï¼‰ï¼Œäº’ä¸å¹²æ‰°
- **å¯é€‰å®ç°**: æŠ€èƒ½å¯é€‰æ‹©æ€§å®ç°IParameterizedSpellï¼Œæœªå®ç°çš„æŠ€èƒ½ä¿æŒåŸæ ·
- **100%å‘åå…¼å®¹**: åŸæœ‰æŒ‡ä»¤ã€å·è½´ã€æ³•æœ¯ä¹¦ã€é™„é­”æ­¦å™¨åŠŸèƒ½å®Œå…¨ä¿ç•™

#### NFR-3: å¯ç»´æŠ¤æ€§
- ä»£ç ç¬¦åˆ DRYã€KISSã€SOLID åŸåˆ™
- æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ï¼ˆåŒè½¨åˆ¶åˆ†å±‚ï¼‰
- å®Œæ•´çš„ä¸­æ–‡æ³¨é‡Š
- è¯¦ç»†çš„é”™è¯¯æç¤º

#### NFR-4: å®‰å…¨æ€§ï¼ˆç®€åŒ–ï¼Œä¿¡ä»»ç®¡ç†å‘˜ï¼‰
- åŸºç¡€ç±»å‹æ ¡éªŒï¼ˆé˜²æ­¢ç¨‹åºå´©æºƒï¼‰
- æƒé™æ£€æŸ¥ï¼ˆä»… OP ç­‰çº§ 2+ å¯æ‰§è¡Œï¼‰
- âŒ ä¸é™åˆ¶å‚æ•°å€¼èŒƒå›´ï¼ˆç®¡ç†å‘˜å¯ä¿¡ä»»ï¼Œæ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒï¼‰

---

## 3. æ¶æ„è®¾è®¡

### 3.1 åŒè½¨åˆ¶ç³»ç»Ÿæ¶æ„å›¾ â­æ ¸å¿ƒè®¾è®¡â­

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸ”µ ç©å®¶æ–½æ³•é€šé“ï¼ˆåŸæœ‰ï¼Œé›¶ä¿®æ”¹ï¼‰                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§¦å‘æ–¹å¼: å³é”®å·è½´ã€æ³•æœ¯ä¹¦ã€é™„é­”æ­¦å™¨                          â”‚
â”‚  æ–½æ³•æ¥æº: CastSource.SCROLL / SPELLBOOK / SWORD               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   AbstractSpell.attemptInitiateCast()    â”‚
        â”‚   ã€åŸæœ‰å…¥å£ï¼Œä¸ä¿®æ”¹ã€‘                    â”‚
        â”‚                                          â”‚
        â”‚   âœ“ æ£€æŸ¥é­”æ³•å€¼ (MagicData.getMana)       â”‚
        â”‚   âœ“ æ£€æŸ¥å†·å´ (PlayerCooldowns)           â”‚
        â”‚   âœ“ æ£€æŸ¥é…ç½®é™åˆ¶ (ServerConfigs)         â”‚
        â”‚   âœ“ æ£€æŸ¥å‰ç½®æ¡ä»¶ (checkPreCastConditions) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      AbstractSpell.onCast()              â”‚
        â”‚      ã€åŸæœ‰æ–½æ³•æ–¹æ³•ï¼Œä¸ä¿®æ”¹ã€‘             â”‚
        â”‚                                          â”‚
        â”‚   â€¢ ä½¿ç”¨é…ç½®çš„å‚æ•°                       â”‚
        â”‚   â€¢ å—é…ç½®ç³»ç»Ÿé™åˆ¶                       â”‚
        â”‚   â€¢ ä¿æŒæ¸¸æˆå¹³è¡¡                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  ğŸŸ¢ ç®¡ç†å‘˜æ–½æ³•é€šé“ï¼ˆæ–°å¢ï¼Œæ—è·¯è®¾è®¡ï¼‰              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§¦å‘æ–¹å¼: /cast æŒ‡ä»¤ + JSONå‚æ•°ï¼ˆä»…OPå¯ç”¨ï¼‰                   â”‚
â”‚  æ–½æ³•æ¥æº: CastSource.COMMAND + SpellParameters                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      CastCommand (åŒè·¯ç”±åˆ¤æ–­)            â”‚
        â”‚                                          â”‚
        â”‚  if (hasJsonParameter) {                 â”‚
        â”‚    â†’ æ–°é€šé“: SpellCastManager            â”‚
        â”‚  } else {                                â”‚
        â”‚    â†’ åŸé€šé“: attemptInitiateCast()       â”‚
        â”‚  }                                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼ ã€æ–°é€šé“ã€‘
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   SpellCastManager.castSpell()           â”‚
        â”‚   ã€æ–°å¢æ—è·¯å…¥å£ã€‘                        â”‚
        â”‚                                          â”‚
        â”‚   âœ— è·³è¿‡é­”æ³•å€¼æ£€æŸ¥                       â”‚
        â”‚   âœ— è·³è¿‡å†·å´æ£€æŸ¥                         â”‚
        â”‚   âœ— è·³è¿‡é…ç½®é™åˆ¶                         â”‚
        â”‚   âœ“ ä»…æ ¡éªŒå‚æ•°ç±»å‹å’Œå¿…å¡«æ€§               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   æ£€æŸ¥: æŠ€èƒ½æ˜¯å¦å®ç°IParameterizedSpell?  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚
         â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… å·²å®ç°æ¥å£       â”‚   â”‚  âŒ æœªå®ç°æ¥å£        â”‚
â”‚                     â”‚   â”‚                      â”‚
â”‚  onCastWithParams() â”‚   â”‚  å›é€€åˆ°onCast()      â”‚
â”‚  ã€æ–°å¢æ–¹æ³•ã€‘       â”‚   â”‚  ã€åŸæœ‰æ–¹æ³•ã€‘        â”‚
â”‚                     â”‚   â”‚                      â”‚
â”‚  â€¢ ä½¿ç”¨JSONå‚æ•°     â”‚   â”‚  â€¢ ä½¿ç”¨é»˜è®¤é€»è¾‘      â”‚
â”‚  â€¢ æ— è§†é…ç½®é™åˆ¶     â”‚   â”‚  â€¢ å—é…ç½®é™åˆ¶        â”‚
â”‚  â€¢ å®Œå…¨è‡ªå®šä¹‰       â”‚   â”‚  â€¢ é™çº§å¤„ç†          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         æ–°å¢ç»„ä»¶å±‚çº§                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‚æ•°ç³»ç»Ÿå±‚ (Parameter Layer) - æ–°å¢                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚Parameters  â”‚  â”‚  Schema     â”‚  â”‚CastOptions â”‚             â”‚
â”‚  â”‚(å‚æ•°å®¹å™¨)  â”‚  â”‚  (å‚æ•°å®šä¹‰) â”‚  â”‚(æ–½æ³•é€‰é¡¹)  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¥å£å±‚ (Interface Layer) - æ–°å¢                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  IParameterizedSpell (å¯é€‰æ¥å£)                         â”‚   â”‚
â”‚  â”‚  - getParameterSchema()                                â”‚   â”‚
â”‚  â”‚  - onCastWithParameters(level, entity, params)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 åŒè·¯ç”±æ•°æ®æµè½¬å›¾

#### è·¯ç”±å†³ç­–æ ‘

```
                 æ–½æ³•è¯·æ±‚
                    â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                         â”‚
       â–¼                         â–¼
  ã€ç©å®¶è§¦å‘ã€‘              ã€æŒ‡ä»¤è§¦å‘ã€‘
  å³é”®å·è½´/ä¹¦/å‰‘           /cast æŒ‡ä»¤
       â”‚                         â”‚
       â”‚                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
       â”‚                    â”‚         â”‚
       â”‚                    â–¼         â–¼
       â”‚              ã€æ— å‚æ•°ã€‘   ã€æœ‰JSONå‚æ•°ã€‘
       â”‚                 â”‚            â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
       â”‚                               â”‚
       â–¼                               â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  åŸæœ‰é€šé“   â”‚            â”‚   æ–°å¢é€šé“      â”‚
  â”‚  å—é…ç½®é™åˆ¶ â”‚            â”‚   æ— é™åˆ¶        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç®¡ç†å‘˜å‚æ•°åŒ–æ–½æ³•æµç¨‹ï¼ˆæ–°é€šé“ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç®¡ç†å‘˜æ‰§è¡Œ                            â”‚
â”‚ /cast @s firebolt 5 {"damage":9999}  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CastCommand (åŒè·¯ç”±åˆ¤æ–­)                â”‚
â”‚                                          â”‚
â”‚  if (jsonParams != null) {               â”‚
â”‚    â†’ SpellCastManager.castSpell()       â”‚ â† ã€æ–°é€šé“ã€‘
â”‚  } else {                                â”‚
â”‚    â†’ spell.attemptInitiateCast()        â”‚ â† ã€åŸé€šé“ã€‘
â”‚  }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ ã€è¿›å…¥æ–°é€šé“ã€‘
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SpellCastManager.castSpell()           â”‚
â”‚  ã€æ—è·¯å…¥å£ï¼Œè·³è¿‡æ‰€æœ‰åŸæœ‰æ ¡éªŒã€‘          â”‚
â”‚                                          â”‚
â”‚  1. è·å–æŠ€èƒ½: SpellRegistry.getSpell    â”‚
â”‚  2. è§£æJSON: SpellParameters.fromJson  â”‚
â”‚  3. æ£€æŸ¥æ¥å£: spell instanceof           â”‚
â”‚     IParameterizedSpell                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ¡éªŒå‚æ•° (ä»…ç±»å‹å’Œå¿…å¡«æ€§)               â”‚
â”‚  SpellParameterSchema.validate()         â”‚
â”‚                                          â”‚
â”‚  âœ“ ç±»å‹åŒ¹é…æ£€æŸ¥                          â”‚
â”‚  âœ“ å¿…å¡«å‚æ•°æ£€æŸ¥                          â”‚
â”‚  âœ— ä¸æ£€æŸ¥å€¼åŸŸèŒƒå›´                        â”‚
â”‚  âœ— ä¸æ£€æŸ¥é…ç½®é™åˆ¶                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FireboltSpell.onCastWithParameters()   â”‚
â”‚  ã€æ–°å¢æ–¹æ³•ï¼Œæ¥æ”¶å‚æ•°ã€‘                  â”‚
â”‚                                          â”‚
â”‚  1. è¯»å–å‚æ•°: params.getFloat("damage") â”‚
â”‚     â†’ ä½¿ç”¨ç®¡ç†å‘˜æŒ‡å®šçš„ 9999              â”‚
â”‚  2. åˆ›å»ºå¼¹ä¸¸å®ä½“                         â”‚
â”‚  3. è®¾ç½®ä¼¤å®³: firebolt.setDamage(9999)  â”‚
â”‚  4. å‘å°„å¼¹ä¸¸                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ¹æ®å‚æ•°å†³å®šè¡Œä¸º (å¯é€‰)                 â”‚
â”‚                                          â”‚
â”‚  if (params.getBoolean("consumeMana")) { â”‚
â”‚    æ‰£é™¤é­”æ³•å€¼                            â”‚
â”‚  }                                       â”‚
â”‚  if (params.getBoolean("triggerCooldown")){â”‚
â”‚    è§¦å‘å†·å´                              â”‚
â”‚  }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç©å®¶å·è½´æ–½æ³•æµç¨‹ï¼ˆåŸé€šé“ï¼Œé›¶ä¿®æ”¹ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç©å®¶å³é”®ç«çƒæœ¯å·è½´        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AbstractSpell.attemptInitiateCast()    â”‚
â”‚  ã€åŸæœ‰å…¥å£ï¼Œå®Œå…¨ä¸åŠ¨ã€‘                  â”‚
â”‚                                          â”‚
â”‚  1. æ£€æŸ¥é­”æ³•å€¼                           â”‚
â”‚  2. æ£€æŸ¥å†·å´                             â”‚
â”‚  3. æ£€æŸ¥é…ç½®é™åˆ¶ (ServerConfigs)         â”‚
â”‚     â†’ æœ€å¤§ä¼¤å®³å€ç‡ 1.0x                  â”‚
â”‚     â†’ æœ€å¤§ç­‰çº§ 10                        â”‚
â”‚  4. æ£€æŸ¥å‰ç½®æ¡ä»¶                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FireboltSpell.onCast()                 â”‚
â”‚  ã€åŸæœ‰æ–¹æ³•ï¼Œå®Œå…¨ä¸åŠ¨ã€‘                  â”‚
â”‚                                          â”‚
â”‚  1. ä½¿ç”¨é»˜è®¤ä¼¤å®³è®¡ç®—                     â”‚
â”‚     getDamage(level, entity)             â”‚
â”‚     â†’ å—é…ç½®å€ç‡é™åˆ¶                     â”‚
â”‚  2. åˆ›å»ºå¼¹ä¸¸å®ä½“                         â”‚
â”‚  3. è®¾ç½®ä¼¤å®³ï¼ˆâ‰¤é…ç½®ä¸Šé™ï¼‰                â”‚
â”‚  4. å‘å°„å¼¹ä¸¸                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  3. åˆ›å»ºå¼¹ä¸¸å®ä½“                        â”‚
â”‚  4. è®¾ç½®ä¼¤å®³: firebolt.setDamage(100)   â”‚
â”‚  5. å‘å°„å¼¹ä¸¸                            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ æŠ€èƒ½æ•ˆæœç”Ÿæ•ˆ
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ–½æ³•ç»“æœåé¦ˆ                    â”‚
â”‚  - æ‰£é™¤é­”æ³•å€¼ (å¦‚ consumeMana=true)     â”‚
â”‚  - è§¦å‘å†·å´ (å¦‚ triggerCooldown=true)   â”‚
â”‚  - åŒæ­¥å®¢æˆ·ç«¯ (ç²’å­ã€éŸ³æ•ˆ)              â”‚
â”‚  - å‘é€æˆåŠŸ/å¤±è´¥æ¶ˆæ¯                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 æ¨¡å—èŒè´£åˆ’åˆ†

#### 3.3.1 å‚æ•°ç³»ç»Ÿå±‚
**ä½ç½®**: `src/main/java/io/redspace/ironsspellbooks/api/spells/parameters/`

- **SpellParameters.java**
  - èŒè´£: å‚æ•°å®¹å™¨ï¼Œç±»å‹å®‰å…¨çš„å‚æ•°è¯»å–
  - æ ¸å¿ƒæ–¹æ³•:
    ```java
    public int getInt(String key, int defaultValue)
    public float getFloat(String key, float defaultValue)
    public String getString(String key, String defaultValue)
    public Vec3 getVec3(String key, Vec3 defaultValue)
    public UUID getUUID(String key)
    public boolean getBoolean(String key, boolean defaultValue)
    public boolean has(String key)
    ```

- **SpellParameterSchema.java**
  - èŒè´£: å‚æ•°å®šä¹‰æ¨¡å¼ï¼Œæ ¡éªŒè§„åˆ™
  - æ ¸å¿ƒæ–¹æ³•:
    ```java
    public static Builder builder()
    public Builder required(String name, ParameterType type)
    public Builder optional(String name, ParameterType type, Object defaultValue)
    public Builder withRange(String name, double min, double max)
    public Builder withValidator(String name, Predicate<Object> validator)
    public SpellParameterSchema build()
    public ValidationResult validate(SpellParameters params)
    ```

- **IParameterizedSpell.java**
  - èŒè´£: å‚æ•°åŒ–æŠ€èƒ½æ¥å£
  - æ ¸å¿ƒæ–¹æ³•:
    ```java
    SpellParameterSchema getParameterSchema();
    void onCastWithParameters(Level level, int spellLevel, LivingEntity entity,
                              CastSource castSource, MagicData playerMagicData,
                              SpellParameters parameters);
    ```

- **ParameterType.java**
  - èŒè´£: å‚æ•°ç±»å‹æšä¸¾
  - æšä¸¾å€¼: `INT`, `FLOAT`, `DOUBLE`, `STRING`, `BOOLEAN`, `VEC3`, `UUID`, `ENTITY_SELECTOR`, `DIMENSION`

#### 3.3.2 æ–½æ³•ç®¡ç†å±‚
**ä½ç½®**: `src/main/java/io/redspace/ironsspellbooks/api/manager/`

- **SpellCastManager.java**
  - èŒè´£: ç»Ÿä¸€æ–½æ³•å…¥å£ API
  - æ ¸å¿ƒæ–¹æ³•:
    ```java
    public static boolean castSpell(ServerPlayer player, String spellId, int level, String jsonParams)
    public static boolean castSpell(ServerPlayer player, String spellId, int level, CompoundTag params)
    public static boolean castSpellDirect(LivingEntity caster, AbstractSpell spell, int level, SpellParameters params, CastOptions options)
    ```

- **CastOptions.java**
  - èŒè´£: æ–½æ³•é€‰é¡¹é…ç½®
  - å­—æ®µ:
    ```java
    public final boolean consumeMana;
    public final boolean triggerCooldown;
    public final boolean playEffects;
    public final boolean bypassConditions;
    public final boolean showCastBar;

    public static CastOptions fromSource(CastSource source)
    public static CastOptions fromParameters(SpellParameters params)
    ```

#### 3.3.3 æ•°æ®ä¼ é€’å±‚
**ä½ç½®**: `src/main/java/io/redspace/ironsspellbooks/spells/parameters/`

- **JsonCastData.java**
  - èŒè´£: JSON å‚æ•°æ•°æ®è½½ä½“
  - å®ç°æ¥å£: `ICastDataSerializable`
  - æ ¸å¿ƒæ–¹æ³•:
    ```java
    public JsonCastData(CompoundTag tag)
    public CompoundTag getTag()
    public SpellParameters toSpellParameters()
    @Override void writeToBuffer(FriendlyByteBuf buffer)
    @Override void readFromBuffer(FriendlyByteBuf buffer)
    @Override CompoundTag serializeNBT()
    @Override void deserializeNBT(CompoundTag tag)
    ```

#### 3.3.4 æŒ‡ä»¤å±‚
**ä½ç½®**: `src/main/java/io/redspace/ironsspellbooks/command/`

- **CastCommand.java (æ‰©å±•)**
  - èŒè´£: æ‰©å±• `/cast` æŒ‡ä»¤ï¼Œæ·»åŠ  JSON å‚æ•°æ”¯æŒ
  - æ–°å¢å‚æ•°ç±»å‹: `StringArgumentType` (ç”¨äºæ¥æ”¶ JSON å­—ç¬¦ä¸²)
  - æ ¸å¿ƒé€»è¾‘:
    ```java
    // æ£€æµ‹æ˜¯å¦æœ‰ JSON å‚æ•°
    if (context has "json" argument) {
        String jsonString = StringArgumentType.getString(context, "json");
        SpellCastManager.castSpell(player, spellId, level, jsonString);
    } else {
        // åŸæœ‰é€»è¾‘ï¼ˆå®Œå…¨å…¼å®¹ï¼‰
    }
    ```

- **SpellsCommand.java (æ–°å¢)**
  - èŒè´£: æŠ€èƒ½å‚æ•°æ–‡æ¡£æŸ¥è¯¢
  - å­æŒ‡ä»¤:
    ```java
    /iss spells list [page]                     // åˆ†é¡µåˆ—è¡¨
    /iss spells doc <spellId>                   // æ˜¾ç¤ºæ–‡æ¡£
    /iss spells export [json|markdown] [path]   // å¯¼å‡ºæ–‡æ¡£
    ```

#### 3.3.5 æ–‡æ¡£ç”Ÿæˆå±‚
**ä½ç½®**: `src/main/java/io/redspace/ironsspellbooks/util/doc/`

- **SpellDocGenerator.java**
  - èŒè´£: è‡ªåŠ¨ç”ŸæˆæŠ€èƒ½å‚æ•°æ–‡æ¡£
  - æ ¸å¿ƒæ–¹æ³•:
    ```java
    public static void generateAllDocs(Path outputDir)
    public static JsonObject generateJsonDoc(AbstractSpell spell)
    public static String generateMarkdownDoc(AbstractSpell spell)
    public static void exportToFile(Path filePath, String format)
    ```

---

## 4. è¯¦ç»†å®æ–½è®¡åˆ’

### 4.1 é˜¶æ®µ 1: å‚æ•°ç³»ç»ŸåŸºç¡€æ¡†æ¶ (é¢„è®¡ 2-3 å°æ—¶)

#### æ­¥éª¤ 1.1: åˆ›å»ºå‚æ•°ç±»å‹æšä¸¾
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/api/spells/parameters/ParameterType.java`

**ä»£ç ç»“æ„**:
```java
package io.redspace.ironsspellbooks.api.spells.parameters;

import com.google.gson.JsonElement;
import net.minecraft.nbt.CompoundTag;
import net.minecraft.world.phys.Vec3;

import java.util.UUID;
import java.util.function.Function;

/**
 * æŠ€èƒ½å‚æ•°ç±»å‹æšä¸¾
 * å®šä¹‰æ‰€æœ‰æ”¯æŒçš„å‚æ•°ç±»å‹åŠå…¶è§£ææ–¹æ³•
 */
public enum ParameterType {
    INT("æ•´æ•°", JsonElement::getAsInt, tag -> tag.getInt("value")),
    FLOAT("æµ®ç‚¹æ•°", JsonElement::getAsFloat, tag -> tag.getFloat("value")),
    DOUBLE("åŒç²¾åº¦", JsonElement::getAsDouble, tag -> tag.getDouble("value")),
    STRING("å­—ç¬¦ä¸²", JsonElement::getAsString, tag -> tag.getString("value")),
    BOOLEAN("å¸ƒå°”å€¼", JsonElement::getAsBoolean, tag -> tag.getBoolean("value")),
    VEC3("ä¸‰ç»´åæ ‡", ParameterType::parseVec3FromJson, ParameterType::parseVec3FromNBT),
    UUID("å®ä½“UUID", json -> UUID.fromString(json.getAsString()), tag -> tag.getUUID("value")),
    ENTITY_SELECTOR("å®ä½“é€‰æ‹©å™¨", JsonElement::getAsString, tag -> tag.getString("value")),
    DIMENSION("ç»´åº¦", JsonElement::getAsString, tag -> tag.getString("value"));

    private final String displayName;
    private final Function<JsonElement, Object> jsonParser;
    private final Function<CompoundTag, Object> nbtParser;

    ParameterType(String displayName,
                  Function<JsonElement, Object> jsonParser,
                  Function<CompoundTag, Object> nbtParser) {
        this.displayName = displayName;
        this.jsonParser = jsonParser;
        this.nbtParser = nbtParser;
    }

    public String getDisplayName() {
        return displayName;
    }

    public Object parseFromJson(JsonElement element) throws Exception {
        return jsonParser.apply(element);
    }

    public Object parseFromNBT(CompoundTag tag) {
        return nbtParser.apply(tag);
    }

    private static Vec3 parseVec3FromJson(JsonElement element) {
        var array = element.getAsJsonArray();
        return new Vec3(array.get(0).getAsDouble(),
                       array.get(1).getAsDouble(),
                       array.get(2).getAsDouble());
    }

    private static Vec3 parseVec3FromNBT(CompoundTag tag) {
        return new Vec3(tag.getDouble("x"), tag.getDouble("y"), tag.getDouble("z"));
    }
}
```

#### æ­¥éª¤ 1.2: åˆ›å»ºå‚æ•°å®¹å™¨
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/api/spells/parameters/SpellParameters.java`

**ä»£ç ç»“æ„**:
```java
package io.redspace.ironsspellbooks.api.spells.parameters;

import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
import net.minecraft.nbt.CompoundTag;
import net.minecraft.world.phys.Vec3;

import javax.annotation.Nullable;
import java.util.HashMap;
import java.util.Map;
import java.util.UUID;

/**
 * æŠ€èƒ½å‚æ•°å®¹å™¨
 * å°è£…å‚æ•°æ•°æ®ï¼Œæä¾›ç±»å‹å®‰å…¨çš„è¯»å–æ–¹æ³•
 */
public class SpellParameters {
    private final Map<String, Object> parameters;

    private SpellParameters(Map<String, Object> parameters) {
        this.parameters = parameters;
    }

    /**
     * ä» JSON å­—ç¬¦ä¸²åˆ›å»ºå‚æ•°å®¹å™¨
     */
    public static SpellParameters fromJson(String jsonString) throws Exception {
        JsonObject json = JsonParser.parseString(jsonString).getAsJsonObject();
        Map<String, Object> params = new HashMap<>();

        for (Map.Entry<String, JsonElement> entry : json.entrySet()) {
            String key = entry.getKey();
            JsonElement value = entry.getValue();

            // æ ¹æ® JSON ç±»å‹è‡ªåŠ¨æ¨æ–­å‚æ•°ç±»å‹
            if (value.isJsonPrimitive()) {
                var primitive = value.getAsJsonPrimitive();
                if (primitive.isNumber()) {
                    if (value.getAsString().contains(".")) {
                        params.put(key, value.getAsDouble());
                    } else {
                        params.put(key, value.getAsInt());
                    }
                } else if (primitive.isBoolean()) {
                    params.put(key, value.getAsBoolean());
                } else if (primitive.isString()) {
                    params.put(key, value.getAsString());
                }
            } else if (value.isJsonArray()) {
                // å°è¯•è§£æä¸º Vec3
                var array = value.getAsJsonArray();
                if (array.size() == 3) {
                    params.put(key, new Vec3(
                        array.get(0).getAsDouble(),
                        array.get(1).getAsDouble(),
                        array.get(2).getAsDouble()
                    ));
                }
            }
        }

        return new SpellParameters(params);
    }

    /**
     * ä» NBT åˆ›å»ºå‚æ•°å®¹å™¨
     */
    public static SpellParameters fromNBT(CompoundTag tag) {
        Map<String, Object> params = new HashMap<>();

        for (String key : tag.getAllKeys()) {
            Object value = switch (tag.getTagType(key)) {
                case 3 -> tag.getInt(key);           // TAG_INT
                case 5 -> tag.getFloat(key);         // TAG_FLOAT
                case 6 -> tag.getDouble(key);        // TAG_DOUBLE
                case 8 -> tag.getString(key);        // TAG_STRING
                case 1 -> tag.getBoolean(key);       // TAG_BYTE (boolean)
                case 10 -> {                         // TAG_COMPOUND (å¯èƒ½æ˜¯ Vec3 æˆ– UUID)
                    CompoundTag compound = tag.getCompound(key);
                    if (compound.contains("x") && compound.contains("y") && compound.contains("z")) {
                        yield new Vec3(compound.getDouble("x"),
                                      compound.getDouble("y"),
                                      compound.getDouble("z"));
                    } else if (compound.contains("uuid")) {
                        yield compound.getUUID("uuid");
                    }
                    yield compound;
                }
                default -> null;
            };

            if (value != null) {
                params.put(key, value);
            }
        }

        return new SpellParameters(params);
    }

    // ========== ç±»å‹å®‰å…¨çš„è¯»å–æ–¹æ³• ==========

    public int getInt(String key, int defaultValue) {
        Object value = parameters.get(key);
        if (value instanceof Number number) {
            return number.intValue();
        }
        return defaultValue;
    }

    public float getFloat(String key, float defaultValue) {
        Object value = parameters.get(key);
        if (value instanceof Number number) {
            return number.floatValue();
        }
        return defaultValue;
    }

    public double getDouble(String key, double defaultValue) {
        Object value = parameters.get(key);
        if (value instanceof Number number) {
            return number.doubleValue();
        }
        return defaultValue;
    }

    public String getString(String key, String defaultValue) {
        Object value = parameters.get(key);
        if (value instanceof String str) {
            return str;
        }
        return defaultValue;
    }

    public boolean getBoolean(String key, boolean defaultValue) {
        Object value = parameters.get(key);
        if (value instanceof Boolean bool) {
            return bool;
        }
        return defaultValue;
    }

    public Vec3 getVec3(String key, @Nullable Vec3 defaultValue) {
        Object value = parameters.get(key);
        if (value instanceof Vec3 vec) {
            return vec;
        }
        return defaultValue;
    }

    @Nullable
    public UUID getUUID(String key) {
        Object value = parameters.get(key);
        if (value instanceof UUID uuid) {
            return uuid;
        }
        if (value instanceof String str) {
            try {
                return UUID.fromString(str);
            } catch (IllegalArgumentException e) {
                return null;
            }
        }
        return null;
    }

    public boolean has(String key) {
        return parameters.containsKey(key);
    }

    @Nullable
    public Object get(String key) {
        return parameters.get(key);
    }

    /**
     * è½¬æ¢ä¸º NBT ç”¨äºç½‘ç»œä¼ è¾“
     */
    public CompoundTag toNBT() {
        CompoundTag tag = new CompoundTag();

        for (Map.Entry<String, Object> entry : parameters.entrySet()) {
            String key = entry.getKey();
            Object value = entry.getValue();

            if (value instanceof Integer i) {
                tag.putInt(key, i);
            } else if (value instanceof Float f) {
                tag.putFloat(key, f);
            } else if (value instanceof Double d) {
                tag.putDouble(key, d);
            } else if (value instanceof String s) {
                tag.putString(key, s);
            } else if (value instanceof Boolean b) {
                tag.putBoolean(key, b);
            } else if (value instanceof Vec3 vec) {
                CompoundTag vecTag = new CompoundTag();
                vecTag.putDouble("x", vec.x);
                vecTag.putDouble("y", vec.y);
                vecTag.putDouble("z", vec.z);
                tag.put(key, vecTag);
            } else if (value instanceof UUID uuid) {
                CompoundTag uuidTag = new CompoundTag();
                uuidTag.putUUID("uuid", uuid);
                tag.put(key, uuidTag);
            }
        }

        return tag;
    }
}
```

#### æ­¥éª¤ 1.3: åˆ›å»ºå‚æ•°å®šä¹‰æ¨¡å¼
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/api/spells/parameters/SpellParameterSchema.java`

**ä»£ç ç»“æ„**:
```java
package io.redspace.ironsspellbooks.api.spells.parameters;

import net.minecraft.network.chat.Component;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.function.Predicate;

/**
 * æŠ€èƒ½å‚æ•°å®šä¹‰æ¨¡å¼
 * ç”¨äºå£°æ˜æŠ€èƒ½æ”¯æŒçš„å‚æ•°åŠå…¶æ ¡éªŒè§„åˆ™
 */
public class SpellParameterSchema {
    private final Map<String, ParameterDefinition> definitions;

    private SpellParameterSchema(Map<String, ParameterDefinition> definitions) {
        this.definitions = definitions;
    }

    public static Builder builder() {
        return new Builder();
    }

    /**
     * æ ¡éªŒå‚æ•°æ˜¯å¦ç¬¦åˆæ¨¡å¼å®šä¹‰
     */
    public ValidationResult validate(SpellParameters params) {
        List<String> errors = new ArrayList<>();

        // æ£€æŸ¥å¿…å¡«å‚æ•°
        for (Map.Entry<String, ParameterDefinition> entry : definitions.entrySet()) {
            String key = entry.getKey();
            ParameterDefinition def = entry.getValue();

            if (def.required && !params.has(key)) {
                errors.add(String.format("ç¼ºå°‘å¿…å¡«å‚æ•°: %s (%s)", key, def.type.getDisplayName()));
                continue;
            }

            if (params.has(key)) {
                Object value = params.get(key);

                // ç±»å‹æ ¡éªŒ
                if (!def.validateType(value)) {
                    errors.add(String.format("å‚æ•° '%s' ç±»å‹é”™è¯¯ï¼ŒæœŸæœ›: %s", key, def.type.getDisplayName()));
                    continue;
                }

                // è‡ªå®šä¹‰æ ¡éªŒå™¨
                if (def.validator != null && !def.validator.test(value)) {
                    errors.add(String.format("å‚æ•° '%s' æ ¡éªŒå¤±è´¥: %s", key, def.validationMessage));
                }
            }
        }

        return errors.isEmpty() ? ValidationResult.success()
                                : ValidationResult.failure(errors);
    }

    public Map<String, ParameterDefinition> getDefinitions() {
        return definitions;
    }

    // ========== å†…éƒ¨ç±» ==========

    public static class ParameterDefinition {
        public final String name;
        public final ParameterType type;
        public final boolean required;
        public final Object defaultValue;
        public final String description;
        public final Predicate<Object> validator;
        public final String validationMessage;

        ParameterDefinition(String name, ParameterType type, boolean required,
                          Object defaultValue, String description,
                          Predicate<Object> validator, String validationMessage) {
            this.name = name;
            this.type = type;
            this.required = required;
            this.defaultValue = defaultValue;
            this.description = description;
            this.validator = validator;
            this.validationMessage = validationMessage;
        }

        boolean validateType(Object value) {
            return switch (type) {
                case INT, FLOAT, DOUBLE -> value instanceof Number;
                case STRING, ENTITY_SELECTOR, DIMENSION -> value instanceof String;
                case BOOLEAN -> value instanceof Boolean;
                case VEC3 -> value instanceof net.minecraft.world.phys.Vec3;
                case UUID -> value instanceof java.util.UUID || value instanceof String;
            };
        }
    }

    public static class Builder {
        private final Map<String, ParameterDefinition> definitions = new HashMap<>();

        public Builder required(String name, ParameterType type, String description) {
            definitions.put(name, new ParameterDefinition(
                name, type, true, null, description, null, null
            ));
            return this;
        }

        public Builder optional(String name, ParameterType type, Object defaultValue, String description) {
            definitions.put(name, new ParameterDefinition(
                name, type, false, defaultValue, description, null, null
            ));
            return this;
        }

        public Builder withValidator(String name, Predicate<Object> validator, String message) {
            ParameterDefinition existing = definitions.get(name);
            if (existing != null) {
                definitions.put(name, new ParameterDefinition(
                    existing.name, existing.type, existing.required, existing.defaultValue,
                    existing.description, validator, message
                ));
            }
            return this;
        }

        public Builder withRange(String name, double min, double max) {
            return withValidator(name,
                value -> {
                    if (value instanceof Number num) {
                        double d = num.doubleValue();
                        return d >= min && d <= max;
                    }
                    return false;
                },
                String.format("å€¼å¿…é¡»åœ¨ %.2f åˆ° %.2f ä¹‹é—´", min, max)
            );
        }

        public SpellParameterSchema build() {
            return new SpellParameterSchema(new HashMap<>(definitions));
        }
    }

    public static class ValidationResult {
        public final boolean success;
        public final List<String> errors;

        private ValidationResult(boolean success, List<String> errors) {
            this.success = success;
            this.errors = errors;
        }

        public static ValidationResult success() {
            return new ValidationResult(true, List.of());
        }

        public static ValidationResult failure(List<String> errors) {
            return new ValidationResult(false, errors);
        }

        public Component toComponent() {
            if (success) {
                return Component.literal("å‚æ•°æ ¡éªŒæˆåŠŸ");
            } else {
                return Component.literal("å‚æ•°æ ¡éªŒå¤±è´¥:\n" + String.join("\n", errors));
            }
        }
    }
}
```

#### æ­¥éª¤ 1.4: åˆ›å»ºå‚æ•°åŒ–æŠ€èƒ½æ¥å£
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/api/spells/parameters/IParameterizedSpell.java`

**ä»£ç ç»“æ„**:
```java
package io.redspace.ironsspellbooks.api.spells.parameters;

import io.redspace.ironsspellbooks.api.magic.MagicData;
import io.redspace.ironsspellbooks.api.spells.CastSource;
import net.minecraft.world.entity.LivingEntity;
import net.minecraft.world.level.Level;

/**
 * å‚æ•°åŒ–æŠ€èƒ½æ¥å£
 * å®ç°æ­¤æ¥å£çš„æŠ€èƒ½å¯é€šè¿‡æŒ‡ä»¤æ¥æ”¶ JSON å‚æ•°
 */
public interface IParameterizedSpell {

    /**
     * è·å–æŠ€èƒ½çš„å‚æ•°å®šä¹‰æ¨¡å¼
     * @return å‚æ•°æ¨¡å¼ï¼ˆå®šä¹‰æ”¯æŒçš„å‚æ•°ã€ç±»å‹ã€æ ¡éªŒè§„åˆ™ç­‰ï¼‰
     */
    SpellParameterSchema getParameterSchema();

    /**
     * ä½¿ç”¨å‚æ•°æ‰§è¡Œæ–½æ³•
     * @param level ä¸–ç•Œ
     * @param spellLevel æŠ€èƒ½ç­‰çº§
     * @param entity æ–½æ³•è€…
     * @param castSource æ–½æ³•æ¥æº
     * @param playerMagicData ç©å®¶é­”æ³•æ•°æ®
     * @param parameters å‚æ•°å®¹å™¨
     */
    void onCastWithParameters(Level level, int spellLevel, LivingEntity entity,
                             CastSource castSource, MagicData playerMagicData,
                             SpellParameters parameters);
}
```

#### æ­¥éª¤ 1.5: åˆ›å»º JSON æ•°æ®è½½ä½“
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/spells/parameters/JsonCastData.java`

**ä»£ç ç»“æ„**:
```java
package io.redspace.ironsspellbooks.spells.parameters;

import io.redspace.ironsspellbooks.api.network.ISerializable;
import io.redspace.ironsspellbooks.api.spells.ICastDataSerializable;
import io.redspace.ironsspellbooks.api.spells.parameters.SpellParameters;
import net.minecraft.nbt.CompoundTag;
import net.minecraft.network.FriendlyByteBuf;

/**
 * JSON å‚æ•°æ•°æ®è½½ä½“
 * ç”¨äºåœ¨æ–½æ³•è¿‡ç¨‹ä¸­ä¼ é€’ JSON å‚æ•°
 * å®ç° ICastDataSerializable ä»¥æ”¯æŒç½‘ç»œåºåˆ—åŒ–å’Œ NBT å­˜å‚¨
 */
public class JsonCastData implements ICastDataSerializable {
    private CompoundTag tag;

    public JsonCastData() {
        this.tag = new CompoundTag();
    }

    public JsonCastData(CompoundTag tag) {
        this.tag = tag;
    }

    public JsonCastData(SpellParameters parameters) {
        this.tag = parameters.toNBT();
    }

    public CompoundTag getTag() {
        return tag;
    }

    public SpellParameters toSpellParameters() {
        return SpellParameters.fromNBT(tag);
    }

    @Override
    public void writeToBuffer(FriendlyByteBuf buffer) {
        buffer.writeNbt(tag);
    }

    @Override
    public void readFromBuffer(FriendlyByteBuf buffer) {
        this.tag = buffer.readNbt();
    }

    @Override
    public CompoundTag serializeNBT() {
        return tag.copy();
    }

    @Override
    public void deserializeNBT(CompoundTag nbt) {
        this.tag = nbt.copy();
    }

    @Override
    public void reset() {
        this.tag = new CompoundTag();
    }
}
```

---

### 4.2 é˜¶æ®µ 2: æ–½æ³•ç®¡ç†å™¨ (é¢„è®¡ 1-2 å°æ—¶)

#### æ­¥éª¤ 2.1: åˆ›å»ºæ–½æ³•é€‰é¡¹ç±»
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/api/spells/CastOptions.java`

**ä»£ç ç»“æ„**:
```java
package io.redspace.ironsspellbooks.api.spells;

import io.redspace.ironsspellbooks.api.spells.parameters.SpellParameters;

/**
 * æ–½æ³•é€‰é¡¹é…ç½®
 * æ§åˆ¶æ–½æ³•è¿‡ç¨‹ä¸­çš„è¡Œä¸ºï¼ˆé­”æ³•æ¶ˆè€—ã€å†·å´ã€ç‰¹æ•ˆç­‰ï¼‰
 */
public class CastOptions {
    public final boolean consumeMana;       // æ˜¯å¦æ¶ˆè€—é­”æ³•å€¼
    public final boolean triggerCooldown;   // æ˜¯å¦è§¦å‘å†·å´
    public final boolean playEffects;       // æ˜¯å¦æ’­æ”¾ç‰¹æ•ˆ
    public final boolean bypassConditions;  // æ˜¯å¦è·³è¿‡å‰ç½®æ¡ä»¶
    public final boolean showCastBar;       // æ˜¯å¦æ˜¾ç¤ºæ–½æ³•è¿›åº¦æ¡

    private CastOptions(boolean consumeMana, boolean triggerCooldown,
                       boolean playEffects, boolean bypassConditions,
                       boolean showCastBar) {
        this.consumeMana = consumeMana;
        this.triggerCooldown = triggerCooldown;
        this.playEffects = playEffects;
        this.bypassConditions = bypassConditions;
        this.showCastBar = showCastBar;
    }

    /**
     * æ ¹æ®æ–½æ³•æ¥æºåˆ›å»ºé»˜è®¤é€‰é¡¹
     */
    public static CastOptions fromSource(CastSource source) {
        return switch (source) {
            case SPELLBOOK -> new CastOptions(true, true, true, false, true);
            case SCROLL -> new CastOptions(false, false, true, false, false);
            case SWORD -> new CastOptions(true, true, true, false, true);
            case COMMAND -> new CastOptions(false, false, true, true, false);
            case MOB -> new CastOptions(false, false, true, false, false);
            case NONE -> new CastOptions(false, false, false, false, false);
        };
    }

    /**
     * ä»å‚æ•°ä¸­è¯»å–é€‰é¡¹ï¼ˆè¦†ç›–é»˜è®¤å€¼ï¼‰
     */
    public static CastOptions fromParameters(SpellParameters params, CastSource source) {
        CastOptions defaults = fromSource(source);

        return new CastOptions(
            params.getBoolean("consumeMana", defaults.consumeMana),
            params.getBoolean("triggerCooldown", defaults.triggerCooldown),
            params.getBoolean("playEffects", defaults.playEffects),
            params.getBoolean("bypassConditions", defaults.bypassConditions),
            params.getBoolean("showCastBar", defaults.showCastBar)
        );
    }

    public static Builder builder() {
        return new Builder();
    }

    public static class Builder {
        private boolean consumeMana = false;
        private boolean triggerCooldown = false;
        private boolean playEffects = true;
        private boolean bypassConditions = false;
        private boolean showCastBar = false;

        public Builder consumeMana(boolean value) {
            this.consumeMana = value;
            return this;
        }

        public Builder triggerCooldown(boolean value) {
            this.triggerCooldown = value;
            return this;
        }

        public Builder playEffects(boolean value) {
            this.playEffects = value;
            return this;
        }

        public Builder bypassConditions(boolean value) {
            this.bypassConditions = value;
            return this;
        }

        public Builder showCastBar(boolean value) {
            this.showCastBar = value;
            return this;
        }

        public CastOptions build() {
            return new CastOptions(consumeMana, triggerCooldown, playEffects,
                                  bypassConditions, showCastBar);
        }
    }
}
```

#### æ­¥éª¤ 2.2: åˆ›å»ºæ–½æ³•ç®¡ç†å™¨
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/api/manager/SpellCastManager.java`

**ä»£ç ç»“æ„**:
```java
package io.redspace.ironsspellbooks.api.manager;

import io.redspace.ironsspellbooks.IronsSpellbooks;
import io.redspace.ironsspellbooks.api.magic.MagicData;
import io.redspace.ironsspellbooks.api.registry.SpellRegistry;
import io.redspace.ironsspellbooks.api.spells.AbstractSpell;
import io.redspace.ironsspellbooks.api.spells.CastOptions;
import io.redspace.ironsspellbooks.api.spells.CastSource;
import io.redspace.ironsspellbooks.api.spells.parameters.IParameterizedSpell;
import io.redspace.ironsspellbooks.api.spells.parameters.SpellParameters;
import io.redspace.ironsspellbooks.api.spells.parameters.SpellParameterSchema;
import io.redspace.ironsspellbooks.spells.parameters.JsonCastData;
import net.minecraft.network.chat.Component;
import net.minecraft.server.level.ServerPlayer;
import net.minecraft.world.entity.LivingEntity;
import net.minecraft.ChatFormatting;

/**
 * ğŸŸ¢ ç®¡ç†å‘˜æ–½æ³•æ—è·¯ç®¡ç†å™¨ï¼ˆæ ¸å¿ƒç»„ä»¶ï¼‰
 *
 * è®¾è®¡ç†å¿µï¼šæä¾›å®Œå…¨ç‹¬ç«‹çš„æ–½æ³•é€šé“ï¼Œç»•è¿‡æ‰€æœ‰ç©å®¶è½¨é“çš„é™åˆ¶
 * - ä¸æ£€æŸ¥é­”æ³•å€¼
 * - ä¸æ£€æŸ¥å†·å´
 * - ä¸æ£€æŸ¥é…ç½®é™åˆ¶ï¼ˆServerConfigsï¼‰
 * - ä»…åšåŸºç¡€ç±»å‹æ ¡éªŒå’Œå‚æ•°æ ¼å¼æ ¡éªŒ
 *
 * é€‚ç”¨åœºæ™¯ï¼šç®¡ç†å‘˜é€šè¿‡ /cast æŒ‡ä»¤ + JSON å‚æ•°æ–½æ³•
 */
public class SpellCastManager {

    /**
     * ç®¡ç†å‘˜æ–½æ³•å…¥å£ï¼šé€šè¿‡ JSON å­—ç¬¦ä¸²å‚æ•°æ–½æ³•
     * @param player æ–½æ³•ç©å®¶
     * @param spellId æŠ€èƒ½ ID
     * @param level æŠ€èƒ½ç­‰çº§
     * @param jsonParams JSON å‚æ•°å­—ç¬¦ä¸²
     * @return æ˜¯å¦æˆåŠŸæ–½æ³•
     */
    public static boolean castSpell(ServerPlayer player, String spellId, int level, String jsonParams) {
        try {
            SpellParameters params = SpellParameters.fromJson(jsonParams);
            return castSpellInternal(player, spellId, level, params);
        } catch (Exception e) {
            player.sendSystemMessage(Component.literal("JSON è§£æå¤±è´¥: " + e.getMessage())
                .withStyle(ChatFormatting.RED));
            IronsSpellbooks.LOGGER.error("æ–½æ³•æŒ‡ä»¤ JSON è§£æé”™è¯¯", e);
            return false;
        }
    }

    /**
     * é€šè¿‡ SpellParameters å¯¹è±¡æ–½æ³•
     */
    public static boolean castSpell(ServerPlayer player, String spellId, int level, SpellParameters params) {
        return castSpellInternal(player, spellId, level, params);
    }

    /**
     * â­ æ—è·¯æ–½æ³•æ ¸å¿ƒé€»è¾‘ â­
     *
     * ä¸åŸæœ‰ AbstractSpell.attemptInitiateCast() çš„åŒºåˆ«ï¼š
     * âœ— ä¸è°ƒç”¨ spell.canBeCastedBy()ï¼ˆè·³è¿‡ç­‰çº§ã€é­”æ³•å€¼ã€å†·å´æ£€æŸ¥ï¼‰
     * âœ— ä¸è°ƒç”¨ spell.checkPreCastConditions()ï¼ˆè·³è¿‡å‰ç½®æ¡ä»¶ï¼‰
     * âœ— ä¸å— ServerConfigs é…ç½®é™åˆ¶
     * âœ“ ç›´æ¥è°ƒç”¨ paramSpell.onCastWithParameters()ï¼ˆæ—è·¯å…¥å£ï¼‰
     * âœ“ é»˜è®¤ä¸æ¶ˆè€—é­”æ³•å€¼å’Œå†·å´ï¼ˆé™¤éå‚æ•°æ˜ç¡®è®¾ç½®ï¼‰
     */
    private static boolean castSpellInternal(ServerPlayer player, String spellId, int level, SpellParameters params) {
        // 1. è·å–æŠ€èƒ½å®ä¾‹
        AbstractSpell spell = SpellRegistry.getSpell(spellId);
        if (spell == null || spell == SpellRegistry.none()) {
            player.sendSystemMessage(Component.literal("æŠ€èƒ½ä¸å­˜åœ¨: " + spellId)
                .withStyle(ChatFormatting.RED));
            return false;
        }

        // 2. æ£€æŸ¥æŠ€èƒ½æ˜¯å¦å®ç°å‚æ•°åŒ–æ¥å£
        if (!(spell instanceof IParameterizedSpell paramSpell)) {
            player.sendSystemMessage(Component.literal("æŠ€èƒ½ '" + spell.getSpellName() + "' ä¸æ”¯æŒå‚æ•°åŒ–æ–½æ³•")
                .withStyle(ChatFormatting.YELLOW));
            // å›é€€åˆ°ç©å®¶è½¨é“ï¼ˆèµ°åŸæœ‰é™åˆ¶æ£€æŸ¥ï¼‰
            return spell.attemptInitiateCast(
                net.minecraft.world.item.ItemStack.EMPTY,
                level,
                player.level(),
                player,
                CastSource.COMMAND,
                false,
                "command"
            );
        }

        // 3. åŸºç¡€å‚æ•°æ ¡éªŒï¼ˆä»…ç±»å‹å’Œå¿…å¡«æ£€æŸ¥ï¼Œæ— å€¼åŸŸé™åˆ¶ï¼‰
        SpellParameterSchema schema = paramSpell.getParameterSchema();
        SpellParameterSchema.ValidationResult validation = schema.validate(params);

        if (!validation.success) {
            player.sendSystemMessage(validation.toComponent().copy().withStyle(ChatFormatting.RED));
            return false;
        }

        // 4. è·å–æ–½æ³•é€‰é¡¹ï¼ˆé»˜è®¤ï¼šä¸æ¶ˆè€—é­”æ³•ï¼Œä¸è§¦å‘å†·å´ï¼‰
        CastOptions options = CastOptions.fromParameters(params, CastSource.COMMAND);

        // 5. è·å–ç©å®¶é­”æ³•æ•°æ®
        MagicData magicData = MagicData.getPlayerMagicData(player);

        // â­ æ³¨æ„ï¼šè¿™é‡Œä¸å†æ£€æŸ¥å‰ç½®æ¡ä»¶ï¼Œå®Œå…¨ç»•è¿‡åŸæœ‰æ ¡éªŒ â­
        // åŸæœ‰ä»£ç ï¼šspell.checkPreCastConditions() â€”â€” å·²ç§»é™¤

        // 6. è®¾ç½® JsonCastDataï¼ˆç”¨äºä¼ é€’å‚æ•°åˆ°æŠ€èƒ½ï¼‰
        JsonCastData castData = new JsonCastData(params);
        magicData.setAdditionalCastData(castData);

        try {
            // 7. â­ ç›´æ¥è°ƒç”¨å‚æ•°åŒ–æ–½æ³•æ–¹æ³•ï¼ˆæ—è·¯å…¥å£ï¼‰ â­
            paramSpell.onCastWithParameters(
                player.level(),
                level,
                player,
                CastSource.COMMAND,
                magicData,
                params
            );

            // 8. å¤„ç†é­”æ³•æ¶ˆè€—ï¼ˆé»˜è®¤ falseï¼Œé™¤éå‚æ•°æ˜ç¡®è®¾ç½® consumeMana: trueï¼‰
            if (options.consumeMana) {
                int manaCost = spell.getManaCost(level);
                magicData.setMana(magicData.getMana() - manaCost);
            }

            // 9. å¤„ç†å†·å´ï¼ˆé»˜è®¤ falseï¼Œé™¤éå‚æ•°æ˜ç¡®è®¾ç½® triggerCooldown: trueï¼‰
            if (options.triggerCooldown) {
                io.redspace.ironsspellbooks.api.magic.MagicHelper.MAGIC_MANAGER.addCooldown(
                    player, spell, CastSource.COMMAND
                );
            }

            // 10. è°ƒç”¨å®Œæˆé’©å­
            spell.onServerCastComplete(player.level(), level, player, magicData, false);

            // 11. å‘é€æˆåŠŸæ¶ˆæ¯
            player.sendSystemMessage(Component.literal("æˆåŠŸæ–½æ”¾æŠ€èƒ½: " + spell.getSpellName())
                .withStyle(ChatFormatting.GREEN));

            return true;

        } catch (Exception e) {
            player.sendSystemMessage(Component.literal("æ–½æ³•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: " + e.getMessage())
                .withStyle(ChatFormatting.RED));
            IronsSpellbooks.LOGGER.error("å‚æ•°åŒ–æ–½æ³•æ‰§è¡Œé”™è¯¯", e);
            return false;
        } finally {
            // 12. æ¸…ç†ä¸´æ—¶æ•°æ®
            magicData.resetAdditionalCastData();
        }
    }

    /**
     * ç›´æ¥æ–½æ³•ï¼ˆé«˜çº§ APIï¼Œä¾›å…¶ä»–æ¨¡å—è°ƒç”¨ï¼‰
     */
    public static boolean castSpellDirect(LivingEntity caster, AbstractSpell spell, int level,
                                         SpellParameters params, CastOptions options) {
        if (!(spell instanceof IParameterizedSpell paramSpell)) {
            return false;
        }

        MagicData magicData = MagicData.getPlayerMagicData(caster);

        try {
            paramSpell.onCastWithParameters(
                caster.level(),
                level,
                caster,
                CastSource.COMMAND,
                magicData,
                params
            );
            return true;
        } catch (Exception e) {
            IronsSpellbooks.LOGGER.error("ç›´æ¥æ–½æ³•å¤±è´¥", e);
            return false;
        }
    }
}
```

---

### 4.3 é˜¶æ®µ 3: æŒ‡ä»¤æ‰©å±• (é¢„è®¡ 1-2 å°æ—¶)

#### æ­¥éª¤ 3.1: æ‰©å±• CastCommandï¼ˆåŒè·¯ç”±å®ç°ï¼‰
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/command/CastCommand.java` (ä¿®æ”¹)

**ä¿®æ”¹ç­–ç•¥**:
```
â­ åŒè·¯ç”±å†³ç­–é€»è¾‘ â­

æŒ‡ä»¤æ ¼å¼                                â†’ è·¯ç”±ç›®æ ‡
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
/cast @s firebolt 5                    â†’ ğŸ”µ ç©å®¶è½¨é“ï¼ˆåŸæœ‰é€»è¾‘ï¼‰
                                           - è°ƒç”¨ spell.attemptInitiateCast()
                                           - æ£€æŸ¥é­”æ³•å€¼ã€å†·å´ã€é…ç½®é™åˆ¶

/cast @s firebolt 5 {"damage": 100}    â†’ ğŸŸ¢ ç®¡ç†å‘˜è½¨é“ï¼ˆæ—è·¯å…¥å£ï¼‰
                                           - è°ƒç”¨ SpellCastManager.castSpell()
                                           - è·³è¿‡æ‰€æœ‰åŸæœ‰æ£€æŸ¥
```

**ä¿®æ”¹å†…å®¹**:
```java
public static void register(CommandDispatcher<CommandSourceStack> dispatcher) {
    dispatcher.register(Commands.literal("cast")
        .requires((p) -> p.hasPermission(2))
        .then(Commands.argument("casters", EntityArgument.entities())
            .then(Commands.argument("spell", SpellArgument.spellArgument())
                // ğŸ”µ æ— å‚æ•°ç‰ˆæœ¬ï¼šç©å®¶è½¨é“
                .executes((context) -> castSpell(context.getSource(),
                    EntityArgument.getEntities(context, "casters"),
                    context.getArgument("spell", String.class)))
                .then(Commands.argument("level", IntegerArgumentType.integer(1))
                    // ğŸ”µ æœ‰ç­‰çº§æ— å‚æ•°ï¼šç©å®¶è½¨é“
                    .executes((context) -> castSpell(context.getSource(),
                        EntityArgument.getEntities(context, "casters"),
                        context.getArgument("spell", String.class),
                        IntegerArgumentType.getInteger(context, "level")))
                    // ğŸŸ¢ æœ‰ç­‰çº§æœ‰ JSONï¼šç®¡ç†å‘˜è½¨é“ï¼ˆæ–°å¢ï¼‰
                    .then(Commands.argument("json", StringArgumentType.greedyString())
                        .executes((context) -> castSpellWithJson(
                            context.getSource(),
                            EntityArgument.getEntities(context, "casters"),
                            context.getArgument("spell", String.class),
                            IntegerArgumentType.getInteger(context, "level"),
                            StringArgumentType.getString(context, "json")
                        ))
                    )
                )
            ))
    );
}

/**
 * ğŸŸ¢ ç®¡ç†å‘˜è½¨é“æ–½æ³•å…¥å£ï¼ˆæ–°å¢æ–¹æ³•ï¼‰
 *
 * é‡è¦ï¼šæ­¤æ–¹æ³•ç›´æ¥è°ƒç”¨ SpellCastManagerï¼Œç»•è¿‡æ‰€æœ‰ç©å®¶è½¨é“çš„é™åˆ¶æ£€æŸ¥
 */
private static int castSpellWithJson(CommandSourceStack source,
                                    Collection<? extends Entity> targets,
                                    String spellId, int spellLevel, String jsonParams) {
    if (!spellId.contains(":")) {
        spellId = IronsSpellbooks.MODID + ":" + spellId;
    }

    int successCount = 0;

    for (Entity target : targets) {
        if (target instanceof ServerPlayer serverPlayer) {
            // â­ å…³é”®ï¼šè°ƒç”¨ SpellCastManagerï¼ˆç®¡ç†å‘˜è½¨é“ï¼‰ï¼Œè·³è¿‡æ‰€æœ‰é™åˆ¶ â­
            boolean success = SpellCastManager.castSpell(
                serverPlayer, spellId, spellLevel, jsonParams
            );
            if (success) {
                successCount++;
            }
        } else {
            source.sendFailure(Component.literal("éç©å®¶å®ä½“æš‚ä¸æ”¯æŒå‚æ•°åŒ–æ–½æ³•"));
        }
    }

    if (successCount > 0) {
        source.sendSuccess(() -> Component.literal(
            String.format("æˆåŠŸä¸º %d ä¸ªç›®æ ‡æ–½æ”¾æŠ€èƒ½", successCount)
        ), true);
    }

    return successCount;
}

/**
 * ğŸ”µ ç©å®¶è½¨é“æ–½æ³•å…¥å£ï¼ˆåŸæœ‰æ–¹æ³•ï¼Œä¿æŒä¸å˜ï¼‰
 *
 * æ­¤æ–¹æ³•èµ°åŸæœ‰é™åˆ¶æ£€æŸ¥ï¼š
 * - spell.attemptInitiateCast()
 * - æ£€æŸ¥é­”æ³•å€¼ã€å†·å´ã€é…ç½®é™åˆ¶ï¼ˆServerConfigsï¼‰
 */
private static int castSpell(CommandSourceStack source,
                            Collection<? extends Entity> targets,
                            String spellId) {
    // åŸæœ‰å®ç°...ä¿æŒä¸å˜
}

private static int castSpell(CommandSourceStack source,
                            Collection<? extends Entity> targets,
                            String spellId, int spellLevel) {
    // åŸæœ‰å®ç°...ä¿æŒä¸å˜
}
```

**åŒè½¨é“è·¯ç”±æ€»ç»“**:
```java
// å…³é”®ä»£ç å¯¹æ¯”ï¼š

// ğŸ”µ ç©å®¶è½¨é“ï¼ˆåŸæœ‰ï¼‰
spell.attemptInitiateCast(...)  // ç»è¿‡æ‰€æœ‰é™åˆ¶æ£€æŸ¥

// ğŸŸ¢ ç®¡ç†å‘˜è½¨é“ï¼ˆæ–°å¢ï¼‰
SpellCastManager.castSpell(player, spellId, level, jsonParams)
    â†’ paramSpell.onCastWithParameters(...)  // ç›´æ¥è°ƒç”¨ï¼Œè·³è¿‡æ£€æŸ¥
```

#### æ­¥éª¤ 3.2: åˆ›å»ºæ–‡æ¡£æŸ¥è¯¢æŒ‡ä»¤
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/command/SpellsCommand.java` (æ–°å¢)

**ä»£ç ç»“æ„**:
```java
package io.redspace.ironsspellbooks.command;

import com.mojang.brigadier.CommandDispatcher;
import com.mojang.brigadier.arguments.IntegerArgumentType;
import io.redspace.ironsspellbooks.IronsSpellbooks;
import io.redspace.ironsspellbooks.api.registry.SpellRegistry;
import io.redspace.ironsspellbooks.api.spells.AbstractSpell;
import io.redspace.ironsspellbooks.api.spells.parameters.IParameterizedSpell;
import io.redspace.ironsspellbooks.api.spells.parameters.SpellParameterSchema;
import io.redspace.ironsspellbooks.util.doc.SpellDocGenerator;
import net.minecraft.ChatFormatting;
import net.minecraft.commands.CommandSourceStack;
import net.minecraft.commands.Commands;
import net.minecraft.network.chat.Component;
import net.minecraft.network.chat.MutableComponent;

import java.util.List;
import java.util.stream.Collectors;

/**
 * /iss spells æŒ‡ä»¤ - æŠ€èƒ½å‚æ•°æ–‡æ¡£æŸ¥è¯¢
 */
public class SpellsCommand {

    public static void register(CommandDispatcher<CommandSourceStack> dispatcher) {
        dispatcher.register(Commands.literal("iss")
            .then(Commands.literal("spells")
                // /iss spells list [page]
                .then(Commands.literal("list")
                    .executes((context) -> listSpells(context.getSource(), 1))
                    .then(Commands.argument("page", IntegerArgumentType.integer(1))
                        .executes((context) -> listSpells(
                            context.getSource(),
                            IntegerArgumentType.getInteger(context, "page")
                        ))
                    )
                )
                // /iss spells doc <spellId>
                .then(Commands.literal("doc")
                    .then(Commands.argument("spell", SpellArgument.spellArgument())
                        .executes((context) -> showSpellDoc(
                            context.getSource(),
                            context.getArgument("spell", String.class)
                        ))
                    )
                )
                // /iss spells export
                .then(Commands.literal("export")
                    .executes((context) -> exportDocs(context.getSource()))
                )
            )
        );
    }

    /**
     * åˆ—å‡ºæ‰€æœ‰æ”¯æŒå‚æ•°åŒ–çš„æŠ€èƒ½
     */
    private static int listSpells(CommandSourceStack source, int page) {
        List<AbstractSpell> parameterizedSpells = SpellRegistry.getEnabledSpells().stream()
            .filter(spell -> spell instanceof IParameterizedSpell)
            .collect(Collectors.toList());

        if (parameterizedSpells.isEmpty()) {
            source.sendFailure(Component.literal("æš‚æ— æ”¯æŒå‚æ•°åŒ–çš„æŠ€èƒ½"));
            return 0;
        }

        int pageSize = 10;
        int totalPages = (int) Math.ceil(parameterizedSpells.size() / (double) pageSize);
        int start = (page - 1) * pageSize;
        int end = Math.min(start + pageSize, parameterizedSpells.size());

        if (page > totalPages || page < 1) {
            source.sendFailure(Component.literal("é¡µç è¶…å‡ºèŒƒå›´ (1-" + totalPages + ")"));
            return 0;
        }

        MutableComponent header = Component.literal("=== å‚æ•°åŒ–æŠ€èƒ½åˆ—è¡¨ (ç¬¬ " + page + "/" + totalPages + " é¡µ) ===")
            .withStyle(ChatFormatting.GOLD, ChatFormatting.BOLD);
        source.sendSuccess(() -> header, false);

        for (int i = start; i < end; i++) {
            AbstractSpell spell = parameterizedSpells.get(i);
            MutableComponent line = Component.literal((i + 1) + ". ")
                .withStyle(ChatFormatting.GRAY)
                .append(Component.literal(spell.getSpellName())
                    .withStyle(ChatFormatting.AQUA))
                .append(Component.literal(" (" + spell.getSpellId() + ")")
                    .withStyle(ChatFormatting.DARK_GRAY));
            source.sendSuccess(() -> line, false);
        }

        return parameterizedSpells.size();
    }

    /**
     * æ˜¾ç¤ºæŠ€èƒ½å‚æ•°æ–‡æ¡£
     */
    private static int showSpellDoc(CommandSourceStack source, String spellId) {
        if (!spellId.contains(":")) {
            spellId = IronsSpellbooks.MODID + ":" + spellId;
        }

        AbstractSpell spell = SpellRegistry.getSpell(spellId);
        if (spell == null || spell == SpellRegistry.none()) {
            source.sendFailure(Component.literal("æŠ€èƒ½ä¸å­˜åœ¨: " + spellId));
            return 0;
        }

        if (!(spell instanceof IParameterizedSpell paramSpell)) {
            source.sendFailure(Component.literal("æŠ€èƒ½ '" + spell.getSpellName() + "' ä¸æ”¯æŒå‚æ•°åŒ–"));
            return 0;
        }

        // æ˜¾ç¤ºæŠ€èƒ½åŸºæœ¬ä¿¡æ¯
        source.sendSuccess(() -> Component.literal("=== " + spell.getSpellName() + " ===")
            .withStyle(ChatFormatting.GOLD, ChatFormatting.BOLD), false);
        source.sendSuccess(() -> Component.literal("ID: " + spell.getSpellId())
            .withStyle(ChatFormatting.GRAY), false);
        source.sendSuccess(() -> Component.literal("å­¦æ´¾: " + spell.getSchoolType().getDisplayName())
            .withStyle(ChatFormatting.GRAY), false);
        source.sendSuccess(() -> Component.literal("æœ€å¤§ç­‰çº§: " + spell.getMaxLevel())
            .withStyle(ChatFormatting.GRAY), false);

        // æ˜¾ç¤ºå‚æ•°åˆ—è¡¨
        SpellParameterSchema schema = paramSpell.getParameterSchema();
        var definitions = schema.getDefinitions();

        if (definitions.isEmpty()) {
            source.sendSuccess(() -> Component.literal("æ­¤æŠ€èƒ½æ— å¯é…ç½®å‚æ•°")
                .withStyle(ChatFormatting.YELLOW), false);
        } else {
            source.sendSuccess(() -> Component.literal("\nå‚æ•°åˆ—è¡¨:")
                .withStyle(ChatFormatting.AQUA, ChatFormatting.BOLD), false);

            for (var entry : definitions.entrySet()) {
                var def = entry.getValue();
                MutableComponent paramLine = Component.literal("  â€¢ ")
                    .withStyle(ChatFormatting.GRAY)
                    .append(Component.literal(def.name)
                        .withStyle(ChatFormatting.GREEN))
                    .append(Component.literal(" [" + def.type.getDisplayName() + "]")
                        .withStyle(ChatFormatting.DARK_AQUA))
                    .append(Component.literal(def.required ? " (å¿…å¡«)" : " (å¯é€‰)")
                        .withStyle(def.required ? ChatFormatting.RED : ChatFormatting.GRAY));

                if (def.defaultValue != null) {
                    paramLine.append(Component.literal(" é»˜è®¤: " + def.defaultValue)
                        .withStyle(ChatFormatting.DARK_GRAY));
                }

                source.sendSuccess(() -> paramLine, false);

                if (def.description != null && !def.description.isEmpty()) {
                    source.sendSuccess(() -> Component.literal("    " + def.description)
                        .withStyle(ChatFormatting.ITALIC, ChatFormatting.GRAY), false);
                }
            }
        }

        // æ˜¾ç¤ºä½¿ç”¨ç¤ºä¾‹
        source.sendSuccess(() -> Component.literal("\nä½¿ç”¨ç¤ºä¾‹:")
            .withStyle(ChatFormatting.YELLOW, ChatFormatting.BOLD), false);
        source.sendSuccess(() -> Component.literal("  /cast @s " + spell.getSpellId() + " 5 {\"å‚æ•°å\":\"å€¼\"}")
            .withStyle(ChatFormatting.WHITE), false);

        return 1;
    }

    /**
     * å¯¼å‡ºæ–‡æ¡£åˆ°æ–‡ä»¶
     */
    private static int exportDocs(CommandSourceStack source) {
        try {
            SpellDocGenerator.generateAllDocs();
            source.sendSuccess(() -> Component.literal("æ–‡æ¡£å·²å¯¼å‡ºåˆ° config/irons_spellbooks/")
                .withStyle(ChatFormatting.GREEN), true);
            return 1;
        } catch (Exception e) {
            source.sendFailure(Component.literal("æ–‡æ¡£å¯¼å‡ºå¤±è´¥: " + e.getMessage()));
            IronsSpellbooks.LOGGER.error("æ–‡æ¡£å¯¼å‡ºé”™è¯¯", e);
            return 0;
        }
    }
}
```

#### æ­¥éª¤ 3.3: æ³¨å†Œæ–°æŒ‡ä»¤
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/registries/CommandRegistry.java` (ä¿®æ”¹)

**ä¿®æ”¹å†…å®¹**:
```java
@SubscribeEvent
public static void onCommandsRegister(RegisterCommandsEvent event) {
    var commandDispatcher = event.getDispatcher();

    // åŸæœ‰æŒ‡ä»¤...
    CastCommand.register(commandDispatcher);  // å·²æ‰©å±•

    // ========== æ–°å¢æŒ‡ä»¤ ==========
    SpellsCommand.register(commandDispatcher);

    // å…¶ä»–æŒ‡ä»¤...
}
```

---

### 4.4 é˜¶æ®µ 4: æŠ€èƒ½æ”¹é€ ç¤ºä¾‹ (é¢„è®¡ 2-3 å°æ—¶)

**æ”¹é€ åŸåˆ™**:
```
â­ åŒè½¨é“æ–¹æ³•åˆ†ç¦» â­

æŠ€èƒ½ç±»å¿…é¡»åŒæ—¶ä¿ç•™ä¸¤ä¸ªæ–¹æ³•ï¼š

1. ğŸ”µ onCast() â€”â€”â€”â€”â€”â€”â€”â€”â€” ç©å®¶è½¨é“ï¼ˆåŸæœ‰æ–¹æ³•ï¼Œç¦æ­¢ä¿®æ”¹ï¼‰
   - ç©å®¶ä½¿ç”¨å·è½´/æ³•æœ¯ä¹¦æ—¶è°ƒç”¨
   - å—é…ç½®æ–‡ä»¶é™åˆ¶ï¼ˆServerConfigsï¼‰
   - å¿…é¡»ä¿æŒåŸæœ‰é€»è¾‘ä¸å˜

2. ğŸŸ¢ onCastWithParameters() â€”â€” ç®¡ç†å‘˜è½¨é“ï¼ˆæ–°å¢æ–¹æ³•ï¼‰
   - ç®¡ç†å‘˜ä½¿ç”¨ /cast + JSON æ—¶è°ƒç”¨
   - ä¸å—é…ç½®é™åˆ¶ï¼Œå‚æ•°å®Œå…¨è‡ªå®šä¹‰
   - å¯ä»¥å¤ç”¨ onCast() çš„æ ¸å¿ƒé€»è¾‘

å®ç°æ–¹å¼ï¼š
- onCast() å¯ä»¥è°ƒç”¨ onCastWithParameters(ç©ºå‚æ•°) å®ç°ä»£ç å¤ç”¨
- æˆ–è€…ä¿æŒ onCast() å®Œå…¨ç‹¬ç«‹ï¼Œæ ¹æ®æŠ€èƒ½å¤æ‚åº¦å†³å®š
```

#### ç¤ºä¾‹ 1: FireboltSpell (ç«çƒæœ¯)
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/spells/fire/FireboltSpell.java` (ä¿®æ”¹)

**ä¿®æ”¹å†…å®¹**:
```java
// å®ç° IParameterizedSpell æ¥å£ï¼ˆä¸å½±å“åŸæœ‰åŠŸèƒ½ï¼‰
public class FireboltSpell extends AbstractSpell implements IParameterizedSpell {

    // ========== åŸæœ‰ä»£ç ä¿æŒä¸å˜ ==========
    // SpellRarityã€CastTypeã€onCast() ç­‰æ–¹æ³•å…¨éƒ¨ä¿ç•™

    // ========== æ–°å¢ï¼šå‚æ•°åŒ–æ¥å£å®ç° ==========

    @Override
    public SpellParameterSchema getParameterSchema() {
        return SpellParameterSchema.builder()
            .optional("damage", ParameterType.FLOAT, null, "ä¼¤å®³å€ç‡ï¼ˆè¦†ç›–é»˜è®¤è®¡ç®—ï¼‰")
            .withRange("damage", 0.0, 1000.0)
            .optional("fireTime", ParameterType.INT, 3, "ç‡ƒçƒ§æ—¶é—´ï¼ˆç§’ï¼‰")
            .withRange("fireTime", 0, 60)
            .optional("target", ParameterType.UUID, null, "ç›®æ ‡å®ä½“ UUID")
            .build();
    }

    /**
     * ğŸŸ¢ ç®¡ç†å‘˜è½¨é“ï¼šå‚æ•°åŒ–æ–½æ³•æ–¹æ³•ï¼ˆæ–°å¢ï¼‰
     *
     * ç”± SpellCastManager ç›´æ¥è°ƒç”¨ï¼Œè·³è¿‡æ‰€æœ‰é™åˆ¶
     * å‚æ•°å¯å®Œå…¨è‡ªå®šä¹‰ï¼šä¼¤å®³ã€ç‡ƒçƒ§æ—¶é—´ç­‰
     */
    @Override
    public void onCastWithParameters(Level level, int spellLevel, LivingEntity entity,
                                    CastSource castSource, MagicData playerMagicData,
                                    SpellParameters parameters) {
        // 1. åˆ›å»ºç«çƒå¼¹ä¸¸å®ä½“
        FireboltProjectile firebolt = new FireboltProjectile(level, entity);

        // 2. è®¾ç½®åˆå§‹ä½ç½®
        firebolt.setPos(entity.position().add(
            0,
            entity.getEyeHeight() - firebolt.getBoundingBox().getYsize() * .5f,
            0
        ));

        // 3. å‘å°„å¼¹ä¸¸
        firebolt.shoot(entity.getLookAngle());

        // 4. â­ å‚æ•°åŒ–ä¼¤å®³è®¾ç½®ï¼ˆå¯å®Œå…¨è¦†ç›–é…ç½®ï¼‰ â­
        float damage;
        if (parameters.has("damage")) {
            // ç®¡ç†å‘˜è½¨é“ï¼šä½¿ç”¨ JSON å‚æ•°æŒ‡å®šçš„ä¼¤å®³ï¼ˆæ— ä¸Šé™ï¼‰
            damage = parameters.getFloat("damage", 0);
            IronsSpellbooks.LOGGER.debug("ç«çƒæœ¯ä½¿ç”¨å‚æ•°ä¼¤å®³: {}", damage);
        } else {
            // å›é€€åˆ°é»˜è®¤è®¡ç®—ï¼ˆä»ç„¶å¯ä»¥è¶…å‡ºé…ç½®é™åˆ¶ï¼‰
            damage = getDamage(spellLevel, entity);
        }
        firebolt.setDamage(damage);

        // 5. â­ å‚æ•°åŒ–ç‡ƒçƒ§æ—¶é—´ï¼ˆå¯å®Œå…¨è‡ªå®šä¹‰ï¼‰ â­
        int fireTime = parameters.getInt("fireTime", 3);
        firebolt.setSecondsOnFire(fireTime);

        // 6. æ·»åŠ åˆ°ä¸–ç•Œ
        level.addFreshEntity(firebolt);

        // 7. è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼ˆæ’­æ”¾éŸ³æ•ˆç­‰ï¼‰
        super.onCast(level, spellLevel, entity, castSource, playerMagicData);
    }

    /**
     * ğŸ”µ ç©å®¶è½¨é“ï¼šåŸæœ‰æ–½æ³•æ–¹æ³•ï¼ˆä¿æŒä¸å˜ï¼Œå¿…é¡»ä¿ç•™ï¼‰
     *
     * ç©å®¶ä½¿ç”¨å·è½´/æ³•æœ¯ä¹¦æ—¶è°ƒç”¨
     * å—é…ç½®æ–‡ä»¶é™åˆ¶ï¼ˆServerConfigsï¼‰ï¼Œä¸å¯ç»•è¿‡
     *
     * å®ç°æ–¹å¼ï¼šå¤ç”¨å‚æ•°åŒ–æ–¹æ³•ï¼Œä¼ å…¥ç©ºå‚æ•°ï¼ˆä»£ç å¤ç”¨ç­–ç•¥ï¼‰
     */
    @Override
    public void onCast(Level world, int spellLevel, LivingEntity entity,
                      CastSource castSource, MagicData playerMagicData) {
        // è°ƒç”¨å‚æ•°åŒ–æ–¹æ³•ï¼Œä¼ å…¥ç©ºå‚æ•°ï¼ˆèµ°é»˜è®¤é€»è¾‘ï¼‰
        onCastWithParameters(world, spellLevel, entity, castSource, playerMagicData,
                            new SpellParameters(new java.util.HashMap<>()));
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# é»˜è®¤ä¼¤å®³
/cast @s firebolt 5

# å›ºå®šä¼¤å®³ 100ï¼Œç‡ƒçƒ§ 10 ç§’
/cast @s firebolt 5 {"damage": 100.0, "fireTime": 10}
```

#### ç¤ºä¾‹ 2: HealSpell (æ²»ç–—æœ¯)
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/spells/holy/HealSpell.java` (ä¿®æ”¹)

**ä¿®æ”¹å†…å®¹**:
```java
public class HealSpell extends AbstractSpell implements IParameterizedSpell {

    // ========== åŸæœ‰ä»£ç ä¿æŒä¸å˜ ==========

    // ========== æ–°å¢ï¼šå‚æ•°åŒ–æ¥å£å®ç° ==========

    @Override
    public SpellParameterSchema getParameterSchema() {
        return SpellParameterSchema.builder()
            .optional("healAmount", ParameterType.FLOAT, null, "æ²»ç–—é‡ï¼ˆè¦†ç›–é»˜è®¤è®¡ç®—ï¼‰")
            .withRange("healAmount", 0.0, 1000.0)
            .optional("target", ParameterType.UUID, null, "ç›®æ ‡å®ä½“ UUIDï¼ˆé»˜è®¤ä¸ºè‡ªå·±ï¼‰")
            .optional("showParticles", ParameterType.BOOLEAN, true, "æ˜¯å¦æ˜¾ç¤ºç²’å­æ•ˆæœ")
            .build();
    }

    /**
     * ğŸŸ¢ ç®¡ç†å‘˜è½¨é“ï¼šå‚æ•°åŒ–æ–½æ³•æ–¹æ³•ï¼ˆæ–°å¢ï¼‰
     */
    @Override
    public void onCastWithParameters(Level level, int spellLevel, LivingEntity entity,
                                    CastSource castSource, MagicData playerMagicData,
                                    SpellParameters parameters) {
        // 1. ç¡®å®šç›®æ ‡ï¼ˆæ”¯æŒå‚æ•°æŒ‡å®š UUIDï¼‰
        LivingEntity target = entity;  // é»˜è®¤ä¸ºè‡ªå·±

        UUID targetUUID = parameters.getUUID("target");
        if (targetUUID != null && level instanceof net.minecraft.server.level.ServerLevel serverLevel) {
            var targetEntity = serverLevel.getEntity(targetUUID);
            if (targetEntity instanceof LivingEntity living) {
                target = living;
            }
        }

        // 2. â­ è®¡ç®—æ²»ç–—é‡ï¼ˆå¯å®Œå…¨è‡ªå®šä¹‰ï¼Œæ— ä¸Šé™ï¼‰ â­
        float healAmount;
        if (parameters.has("healAmount")) {
            // ç®¡ç†å‘˜è½¨é“ï¼šä½¿ç”¨ JSON å‚æ•°æŒ‡å®šçš„æ²»ç–—é‡ï¼ˆæ— ä¸Šé™ï¼‰
            healAmount = parameters.getFloat("healAmount", 0);
        } else {
            // å›é€€åˆ°é»˜è®¤è®¡ç®—
            healAmount = getSpellPower(spellLevel, entity);
        }

        // 3. è§¦å‘æ²»ç–—äº‹ä»¶
        net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(
            new io.redspace.ironsspellbooks.api.events.SpellHealEvent(
                entity, target, healAmount, getSchoolType()
            )
        );

        // 4. æ‰§è¡Œæ²»ç–—
        target.heal(healAmount);

        // 5. â­ ç²’å­æ•ˆæœï¼ˆå¯é€šè¿‡å‚æ•°æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºï¼‰ â­
        if (parameters.getBoolean("showParticles", true)) {
            int count = 16;
            float radius = 1.25f;
            for (int i = 0; i < count; i++) {
                double theta = Math.toRadians(360 / count) * i;
                double x = Math.cos(theta) * radius;
                double z = Math.sin(theta) * radius;
                io.redspace.ironsspellbooks.capabilities.magic.MagicManager.spawnParticles(
                    level, net.minecraft.core.particles.ParticleTypes.HEART,
                    target.position().x + x,
                    target.position().y,
                    target.position().z + z,
                    1, 0, 0, 0, 0.1, false
                );
            }
        }

        super.onCast(level, spellLevel, entity, castSource, playerMagicData);
    }

    /**
     * ğŸ”µ ç©å®¶è½¨é“ï¼šåŸæœ‰æ–½æ³•æ–¹æ³•ï¼ˆä¿æŒä¸å˜ï¼Œå¿…é¡»ä¿ç•™ï¼‰
     */
    @Override
    public void onCast(Level world, int spellLevel, LivingEntity entity,
                      CastSource castSource, MagicData playerMagicData) {
        // å¤ç”¨å‚æ•°åŒ–æ–¹æ³•ï¼Œä¼ å…¥ç©ºå‚æ•°
        onCastWithParameters(world, spellLevel, entity, castSource, playerMagicData,
                            new SpellParameters(new java.util.HashMap<>()));
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# æ²»ç–—è‡ªå·±
/cast @s heal 3

# æ²»ç–—æŒ‡å®šç©å®¶ 50 ç‚¹ç”Ÿå‘½
/cast @s heal 3 {"target": "ç©å®¶-UUID-è¿™é‡Œ", "healAmount": 50.0}

# æ— ç²’å­æ•ˆæœæ²»ç–—
/cast @s heal 3 {"healAmount": 30.0, "showParticles": false}
```

#### ç¤ºä¾‹ 3: PortalSpell (ä¼ é€é—¨)
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/spells/ender/PortalSpell.java` (ä¿®æ”¹)

**ä¿®æ”¹å†…å®¹**:
```java
public class PortalSpell extends AbstractSpell implements IParameterizedSpell {

    // ========== åŸæœ‰ä»£ç ä¿æŒä¸å˜ ==========

    // ========== æ–°å¢ï¼šå‚æ•°åŒ–æ¥å£å®ç° ==========

    @Override
    public SpellParameterSchema getParameterSchema() {
        return SpellParameterSchema.builder()
            .optional("targetPos", ParameterType.VEC3, null, "ç›®æ ‡åæ ‡ [x, y, z]")
            .optional("dimension", ParameterType.DIMENSION, null, "ç›®æ ‡ç»´åº¦ï¼ˆå¦‚ minecraft:the_netherï¼‰")
            .optional("duration", ParameterType.INT, 60, "ä¼ é€é—¨æœ‰æ•ˆæ—¶é—´ï¼ˆç§’ï¼‰")
            .withRange("duration", 1, 600)
            .build();
    }

    /**
     * ğŸŸ¢ ç®¡ç†å‘˜è½¨é“ï¼šå‚æ•°åŒ–æ–½æ³•æ–¹æ³•ï¼ˆæ–°å¢ï¼‰
     */
    @Override
    public void onCastWithParameters(Level level, int spellLevel, LivingEntity entity,
                                    CastSource castSource, MagicData playerMagicData,
                                    SpellParameters parameters) {
        var playerRecasts = playerMagicData.getPlayerRecasts();

        if (!playerRecasts.hasRecastForSpell(getSpellId())) {
            // ============ é¦–æ¬¡æ–½æ”¾ï¼šåˆ›å»ºä¼ é€é—¨ ============

            // â­ è·å–ç›®æ ‡ä½ç½®ï¼ˆå‚æ•°ä¼˜å…ˆï¼Œå¯å®Œå…¨è‡ªå®šä¹‰ï¼‰ â­
            Vec3 targetPosition = parameters.getVec3("targetPos", null);

            if (targetPosition == null) {
                // å›é€€åˆ°åŸæœ‰é€»è¾‘ï¼ˆåŸºäºç›®æ ‡æ£€æµ‹ï¼‰
                if (playerMagicData.getAdditionalCastData() instanceof TargetEntityCastData castTargetingData) {
                    targetPosition = castTargetingData.getTargetPosition(
                        (net.minecraft.server.level.ServerLevel) level
                    );
                }
            }

            if (targetPosition == null) {
                targetPosition = entity.position();
            }

            // åˆ›å»ºä¼ é€é—¨å®ä½“
            // PortalEntity portalEntity = new PortalEntity(level, targetPosition);
            // level.addFreshEntity(portalEntity);

            // â­ è·å–æœ‰æ•ˆæœŸå‚æ•°ï¼ˆå¯è‡ªå®šä¹‰ï¼Œæ— ä¸Šé™ï¼‰ â­
            int durationSeconds = parameters.getInt("duration", 60);
            int ticksToLive = 20 * durationSeconds;

            // åˆ›å»º Recast æ•°æ®
            // PortalData portalData = new PortalData(targetPosition, level.dimension());

            // æ·»åŠ  Recast
            // playerRecasts.addRecast(new RecastInstance(...), (ServerPlayer) entity);

            IronsSpellbooks.LOGGER.debug("ä¼ é€é—¨å·²åˆ›å»ºï¼Œåæ ‡: {}, æœ‰æ•ˆæœŸ: {}ç§’", targetPosition, durationSeconds);

        } else {
            // ============ äºŒæ¬¡æ–½æ”¾ï¼šä¼ é€åˆ°ä¼ é€é—¨ ============
            // åŸæœ‰é€»è¾‘...ä¿æŒä¸å˜
        }

        super.onCast(level, spellLevel, entity, castSource, playerMagicData);
    }

    /**
     * ğŸ”µ ç©å®¶è½¨é“ï¼šåŸæœ‰æ–½æ³•æ–¹æ³•ï¼ˆä¿æŒä¸å˜ï¼Œå¿…é¡»ä¿ç•™ï¼‰
     */
    @Override
    public void onCast(Level level, int spellLevel, LivingEntity entity,
                      CastSource castSource, MagicData playerMagicData) {
        // å¤ç”¨å‚æ•°åŒ–æ–¹æ³•ï¼Œä¼ å…¥ç©ºå‚æ•°
        onCastWithParameters(level, spellLevel, entity, castSource, playerMagicData,
                            new SpellParameters(new java.util.HashMap<>()));
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# åœ¨æŒ‡å®šåæ ‡åˆ›å»ºä¼ é€é—¨
/cast @s portal 5 {"targetPos": [100, 64, 200], "duration": 120}

# è·¨ç»´åº¦ä¼ é€é—¨
/cast @s portal 5 {"targetPos": [0, 100, 0], "dimension": "minecraft:the_nether"}
```

---

### 4.5 é˜¶æ®µ 5: æ–‡æ¡£ç”Ÿæˆå™¨ (é¢„è®¡ 1-2 å°æ—¶)

#### æ–‡æ¡£ç”Ÿæˆå™¨å®ç°
**æ–‡ä»¶**: `src/main/java/io/redspace/ironsspellbooks/util/doc/SpellDocGenerator.java`

**ä»£ç ç»“æ„**:
```java
package io.redspace.ironsspellbooks.util.doc;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.JsonArray;
import com.google.gson.JsonObject;
import io.redspace.ironsspellbooks.IronsSpellbooks;
import io.redspace.ironsspellbooks.api.registry.SpellRegistry;
import io.redspace.ironsspellbooks.api.spells.AbstractSpell;
import io.redspace.ironsspellbooks.api.spells.parameters.IParameterizedSpell;
import io.redspace.ironsspellbooks.api.spells.parameters.SpellParameterSchema;

import java.io.FileWriter;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.List;
import java.util.stream.Collectors;

/**
 * æŠ€èƒ½å‚æ•°æ–‡æ¡£ç”Ÿæˆå™¨
 * è‡ªåŠ¨æ‰«ææ‰€æœ‰å®ç° IParameterizedSpell çš„æŠ€èƒ½ï¼Œç”Ÿæˆæ–‡æ¡£
 */
public class SpellDocGenerator {
    private static final Gson GSON = new GsonBuilder().setPrettyPrinting().create();
    private static final Path OUTPUT_DIR = Paths.get("config", "irons_spellbooks");

    /**
     * ç”Ÿæˆæ‰€æœ‰æ–‡æ¡£
     */
    public static void generateAllDocs() throws IOException {
        // ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨
        Files.createDirectories(OUTPUT_DIR);

        List<AbstractSpell> parameterizedSpells = SpellRegistry.getEnabledSpells().stream()
            .filter(spell -> spell instanceof IParameterizedSpell)
            .collect(Collectors.toList());

        if (parameterizedSpells.isEmpty()) {
            IronsSpellbooks.LOGGER.warn("æœªæ‰¾åˆ°å®ç° IParameterizedSpell çš„æŠ€èƒ½");
            return;
        }

        // ç”Ÿæˆ JSON æ–‡æ¡£
        generateJsonDoc(parameterizedSpells);

        // ç”Ÿæˆ Markdown æ–‡æ¡£
        generateMarkdownDoc(parameterizedSpells);

        IronsSpellbooks.LOGGER.info("æŠ€èƒ½å‚æ•°æ–‡æ¡£ç”Ÿæˆå®Œæˆï¼Œå…± {} ä¸ªæŠ€èƒ½", parameterizedSpells.size());
    }

    /**
     * ç”Ÿæˆ JSON æ ¼å¼æ–‡æ¡£
     */
    private static void generateJsonDoc(List<AbstractSpell> spells) throws IOException {
        JsonArray spellsArray = new JsonArray();

        for (AbstractSpell spell : spells) {
            IParameterizedSpell paramSpell = (IParameterizedSpell) spell;
            JsonObject spellObj = new JsonObject();

            // åŸºæœ¬ä¿¡æ¯
            spellObj.addProperty("id", spell.getSpellId());
            spellObj.addProperty("name", spell.getSpellName());
            spellObj.addProperty("school", spell.getSchoolType().getDisplayName().getString());
            spellObj.addProperty("maxLevel", spell.getMaxLevel());
            spellObj.addProperty("castType", spell.getCastType().name());

            // å‚æ•°å®šä¹‰
            JsonArray paramsArray = new JsonArray();
            SpellParameterSchema schema = paramSpell.getParameterSchema();

            for (var entry : schema.getDefinitions().entrySet()) {
                var def = entry.getValue();
                JsonObject paramObj = new JsonObject();

                paramObj.addProperty("name", def.name);
                paramObj.addProperty("type", def.type.name());
                paramObj.addProperty("typeDisplay", def.type.getDisplayName());
                paramObj.addProperty("required", def.required);

                if (def.defaultValue != null) {
                    paramObj.addProperty("defaultValue", def.defaultValue.toString());
                }

                if (def.description != null) {
                    paramObj.addProperty("description", def.description);
                }

                paramsArray.add(paramObj);
            }

            spellObj.add("parameters", paramsArray);
            spellsArray.add(spellObj);
        }

        // å†™å…¥æ–‡ä»¶
        Path jsonFile = OUTPUT_DIR.resolve("spell_parameters.json");
        try (FileWriter writer = new FileWriter(jsonFile.toFile())) {
            GSON.toJson(spellsArray, writer);
        }

        IronsSpellbooks.LOGGER.info("JSON æ–‡æ¡£å·²ç”Ÿæˆ: {}", jsonFile.toAbsolutePath());
    }

    /**
     * ç”Ÿæˆ Markdown æ ¼å¼æ–‡æ¡£
     */
    private static void generateMarkdownDoc(List<AbstractSpell> spells) throws IOException {
        StringBuilder md = new StringBuilder();

        // æ–‡æ¡£å¤´éƒ¨
        md.append("# Iron's Spells 'n Spellbooks - æŠ€èƒ½å‚æ•°æ–‡æ¡£\n\n");
        md.append("**ç”Ÿæˆæ—¶é—´**: ").append(java.time.LocalDateTime.now()).append("\n");
        md.append("**æŠ€èƒ½æ•°é‡**: ").append(spells.size()).append("\n\n");
        md.append("---\n\n");
        md.append("## ç›®å½•\n\n");

        // ç”Ÿæˆç›®å½•
        for (int i = 0; i < spells.size(); i++) {
            AbstractSpell spell = spells.get(i);
            md.append(String.format("%d. [%s (%s)](#%d-%s)\n",
                i + 1,
                spell.getSpellName(),
                spell.getSpellId(),
                i + 1,
                spell.getSpellId().replace(":", "-").replace("_", "-")
            ));
        }

        md.append("\n---\n\n");

        // ç”Ÿæˆå„æŠ€èƒ½è¯¦ç»†æ–‡æ¡£
        for (int i = 0; i < spells.size(); i++) {
            AbstractSpell spell = spells.get(i);
            IParameterizedSpell paramSpell = (IParameterizedSpell) spell;

            md.append(String.format("## %d. %s\n\n", i + 1, spell.getSpellName()));
            md.append(String.format("**æŠ€èƒ½ ID**: `%s`  \n", spell.getSpellId()));
            md.append(String.format("**å­¦æ´¾**: %s  \n", spell.getSchoolType().getDisplayName().getString()));
            md.append(String.format("**æœ€å¤§ç­‰çº§**: %d  \n", spell.getMaxLevel()));
            md.append(String.format("**æ–½æ³•ç±»å‹**: %s  \n\n", spell.getCastType().name()));

            // å‚æ•°è¡¨æ ¼
            var definitions = paramSpell.getParameterSchema().getDefinitions();

            if (definitions.isEmpty()) {
                md.append("*æ­¤æŠ€èƒ½æ— å¯é…ç½®å‚æ•°*\n\n");
            } else {
                md.append("### å‚æ•°åˆ—è¡¨\n\n");
                md.append("| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |\n");
                md.append("|--------|------|------|--------|------|\n");

                for (var entry : definitions.entrySet()) {
                    var def = entry.getValue();
                    md.append(String.format("| `%s` | %s | %s | %s | %s |\n",
                        def.name,
                        def.type.getDisplayName(),
                        def.required ? "âœ“" : "âœ—",
                        def.defaultValue != null ? "`" + def.defaultValue + "`" : "-",
                        def.description != null ? def.description : "-"
                    ));
                }

                md.append("\n");
            }

            // ä½¿ç”¨ç¤ºä¾‹
            md.append("### ä½¿ç”¨ç¤ºä¾‹\n\n");
            md.append("```bash\n");
            md.append(String.format("# é»˜è®¤æ–½æ³•\n/cast @s %s 5\n\n", spell.getSpellId()));

            if (!definitions.isEmpty()) {
                md.append("# å‚æ•°åŒ–æ–½æ³•\n");
                md.append(String.format("/cast @s %s 5 {", spell.getSpellId()));

                // ç”Ÿæˆç¤ºä¾‹å‚æ•°
                String[] exampleParams = definitions.entrySet().stream()
                    .limit(2)  // åªå±•ç¤ºå‰ 2 ä¸ªå‚æ•°ä½œä¸ºç¤ºä¾‹
                    .map(entry -> {
                        var def = entry.getValue();
                        String exampleValue = switch (def.type) {
                            case INT, FLOAT, DOUBLE -> "100";
                            case BOOLEAN -> "true";
                            case STRING, UUID, ENTITY_SELECTOR, DIMENSION -> "\"example\"";
                            case VEC3 -> "[100, 64, 200]";
                        };
                        return "\"" + def.name + "\": " + exampleValue;
                    })
                    .toArray(String[]::new);

                md.append(String.join(", ", exampleParams));
                md.append("}\n");
            }

            md.append("```\n\n");
            md.append("---\n\n");
        }

        // å†™å…¥æ–‡ä»¶
        Path mdFile = OUTPUT_DIR.resolve("spell_parameters.md");
        try (FileWriter writer = new FileWriter(mdFile.toFile())) {
            writer.write(md.toString());
        }

        IronsSpellbooks.LOGGER.info("Markdown æ–‡æ¡£å·²ç”Ÿæˆ: {}", mdFile.toAbsolutePath());
    }
}
```

---

### 4.6 é˜¶æ®µ 6: æ„å»ºæµ‹è¯•ä¸éªŒè¯ (é¢„è®¡ 2-3 å°æ—¶)

#### æ­¥éª¤ 6.1: ç¼–è¯‘éªŒè¯
```bash
# æ¸…ç†æ—§æ„å»º
gradlew clean

# ç¼–è¯‘é¡¹ç›®
gradlew build

# æ£€æŸ¥ç¼–è¯‘è¾“å‡º
# ç¡®ä¿æ— é”™è¯¯ï¼Œåªæœ‰åˆç†çš„è­¦å‘Š
```

#### æ­¥éª¤ 6.2: æ¸¸æˆå†…æµ‹è¯•æ¸…å•

**æµ‹è¯• 1: åŸºç¡€å…¼å®¹æ€§**
- [ ] `/cast @s firebolt 5` æ­£å¸¸æ‰§è¡Œï¼ˆåŸæœ‰é€»è¾‘ï¼‰
- [ ] `/cast @s heal 3` æ­£å¸¸æ‰§è¡Œ
- [ ] `/cast @s portal 5` æ­£å¸¸æ‰§è¡Œ

**æµ‹è¯• 2: å‚æ•°åŒ–æ–½æ³•**
- [ ] `/cast @s firebolt 5 {"damage": 100.0}` é€ æˆ 100 ä¼¤å®³
- [ ] `/cast @s firebolt 5 {"damage": 50.0, "fireTime": 10}` é€ æˆ 50 ä¼¤å®³ï¼Œç‡ƒçƒ§ 10 ç§’
- [ ] `/cast @s heal 3 {"healAmount": 50.0}` æ²»ç–— 50 ç‚¹ç”Ÿå‘½

**æµ‹è¯• 3: å‚æ•°æ ¡éªŒï¼ˆä»…ç±»å‹æ ¡éªŒï¼Œæ— å€¼åŸŸé™åˆ¶ï¼‰**
- [ ] `/cast @s firebolt 5 {"damage": "abc"}` æç¤ºç±»å‹é”™è¯¯
- [ ] `/cast @s firebolt 5 {invalid json}` æç¤º JSON è§£æé”™è¯¯
- [ ] `/cast @s firebolt 5 {"damage": 9999999}` æ­£å¸¸æ‰§è¡Œï¼ˆç®¡ç†å‘˜è½¨é“æ— ä¸Šé™ï¼‰

**æµ‹è¯• 4: ç®¡ç†å‘˜ç‰¹æƒï¼ˆé»˜è®¤è¡Œä¸ºï¼‰**
- [ ] `/cast @s firebolt 5 {"damage": 100}` é»˜è®¤ä¸æ¶ˆè€—é­”æ³•ã€ä¸è§¦å‘å†·å´
- [ ] `/cast @s firebolt 5 {"consumeMana": true}` æ˜ç¡®æŒ‡å®šåæ‰æ¶ˆè€—é­”æ³•
- [ ] `/cast @s firebolt 5 {"triggerCooldown": true}` æ˜ç¡®æŒ‡å®šåæ‰è§¦å‘å†·å´

**æµ‹è¯• 5: æ–‡æ¡£æŒ‡ä»¤**
- [ ] `/iss spells list` æ˜¾ç¤ºæŠ€èƒ½åˆ—è¡¨
- [ ] `/iss spells doc firebolt` æ˜¾ç¤ºå®Œæ•´å‚æ•°æ–‡æ¡£
- [ ] `/iss spells export` ç”Ÿæˆæ–‡æ¡£æ–‡ä»¶

**æµ‹è¯• 6: è¾¹ç•Œæƒ…å†µ**
- [ ] éç©å®¶å®ä½“ä½¿ç”¨å‚æ•°åŒ–æ–½æ³•çš„æç¤º
- [ ] ä¸æ”¯æŒå‚æ•°åŒ–çš„æŠ€èƒ½çš„é™çº§å¤„ç†
- [ ] ç©º JSON `{}` æ­£å¸¸æ‰§è¡Œ

#### æ­¥éª¤ 6.3: æ€§èƒ½æµ‹è¯•
```bash
# å‹åŠ›æµ‹è¯•ï¼šè¿ç»­æ–½æ³• 100 æ¬¡
/execute as @a run cast @s firebolt 5 {"damage": 100.0}

# ç›‘æ§ TPS å’Œå†…å­˜å ç”¨
# ç¡®ä¿æ— æ˜æ˜¾æ€§èƒ½ä¸‹é™
```

---

## 5. å…³é”®æŠ€æœ¯å®ç°

### 5.1 JSON è§£æä¸ NBT è½¬æ¢

**æŒ‘æˆ˜**: JSON å’Œ NBT ç±»å‹ç³»ç»Ÿä¸å®Œå…¨ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**:
1. ç»Ÿä¸€ä½¿ç”¨ `CompoundTag` ä½œä¸ºä¸­é—´æ ¼å¼
2. `SpellParameters` æä¾›ç±»å‹å®‰å…¨çš„è¯»å–æ–¹æ³•
3. è‡ªåŠ¨ç±»å‹æ¨æ–­ï¼ˆå¦‚æ•°å­—è‡ªåŠ¨åŒºåˆ† int/float/doubleï¼‰

**ä»£ç ç¤ºä¾‹**:
```java
// JSON â†’ SpellParameters â†’ NBT
String json = "{\"damage\": 100.0, \"target\": [10, 64, 20]}";
SpellParameters params = SpellParameters.fromJson(json);
CompoundTag nbt = params.toNBT();

// ç½‘ç»œä¼ è¾“
FriendlyByteBuf buffer = ...;
buffer.writeNbt(nbt);

// æ¥æ”¶ç«¯
CompoundTag receivedNbt = buffer.readNbt();
SpellParameters receivedParams = SpellParameters.fromNBT(receivedNbt);
```

### 5.2 å‚æ•°æ ¡éªŒæµç¨‹

**æ ¡éªŒå±‚çº§**:
1. **JSON è¯­æ³•æ ¡éªŒ** (JsonParser)
2. **ç±»å‹æ ¡éªŒ** (ParameterType)
3. **å¿…å¡«æ€§æ ¡éªŒ** (SpellParameterSchema)
4. **å€¼åŸŸæ ¡éªŒ** (Validator)

**é”™è¯¯å¤„ç†**:
- æ‰€æœ‰æ ¡éªŒé”™è¯¯æ”¶é›†åˆ° `List<String> errors`
- ä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰é”™è¯¯ï¼Œæ–¹ä¾¿ç”¨æˆ·ä¿®æ­£
- å‹å¥½çš„ä¸­æ–‡é”™è¯¯æç¤º

### 5.3 å‘åå…¼å®¹ç­–ç•¥ï¼ˆåŒè½¨åˆ¶é›¶ä¾µå…¥è®¾è®¡ï¼‰

**ç­–ç•¥ 1: åŒè½¨é“éš”ç¦» â­æ ¸å¿ƒç­–ç•¥â­**
```
ğŸ”µ ç©å®¶è½¨é“ï¼ˆ100% ä¿æŒä¸å˜ï¼‰
   - åŸæœ‰æ‰€æœ‰ä»£ç å®Œå…¨ä¸åŠ¨
   - AbstractSpell.attemptInitiateCast() ä¿ç•™
   - ServerConfigs é…ç½®ç³»ç»Ÿä¿ç•™
   - é­”æ³•å€¼ã€å†·å´ã€æƒé™æ£€æŸ¥ä¿ç•™

ğŸŸ¢ ç®¡ç†å‘˜è½¨é“ï¼ˆæ–°å¢æ—è·¯ï¼‰
   - SpellCastManager ä½œä¸ºç‹¬ç«‹å…¥å£
   - ç›´æ¥è°ƒç”¨ onCastWithParameters()
   - å®Œå…¨ç»•è¿‡åŸæœ‰æ£€æŸ¥é€»è¾‘
```

**ç­–ç•¥ 2: æ¥å£å¯é€‰å®ç°**
- æŠ€èƒ½å¯é€‰æ‹©æ€§å®ç° `IParameterizedSpell`
- æœªå®ç°çš„æŠ€èƒ½ï¼šå›é€€åˆ°ç©å®¶è½¨é“ï¼ˆåŸæœ‰é€»è¾‘ï¼‰
- å·²å®ç°çš„æŠ€èƒ½ï¼šç®¡ç†å‘˜è½¨é“å¯ç”¨ï¼Œç©å®¶è½¨é“ä¸å—å½±å“

**ç­–ç•¥ 3: æ–¹æ³•èŒè´£åˆ†ç¦»**
- `onCast()` æ–¹æ³•ï¼šç©å®¶è½¨é“ä¸“ç”¨ï¼Œç¦æ­¢ä¿®æ”¹
- `onCastWithParameters()` æ–¹æ³•ï¼šç®¡ç†å‘˜è½¨é“ä¸“ç”¨ï¼Œæ–°å¢
- ä»£ç å¤ç”¨æ–¹å¼ï¼š`onCast()` å¯è°ƒç”¨ `onCastWithParameters(ç©ºå‚æ•°)`

**ç­–ç•¥ 4: æŒ‡ä»¤åŒè·¯ç”±**
```java
// CastCommand è·¯ç”±å†³ç­–
if (jsonParams != null) {
    // ğŸŸ¢ ç®¡ç†å‘˜è½¨é“
    SpellCastManager.castSpell(player, spellId, level, jsonParams);
} else {
    // ğŸ”µ ç©å®¶è½¨é“
    spell.attemptInitiateCast(...);
}
```

### 5.4 ç½‘ç»œåŒæ­¥æœºåˆ¶

**é—®é¢˜**: å®¢æˆ·ç«¯éœ€è¦æ¥æ”¶å‚æ•°ä»¥æ’­æ”¾ç‰¹æ•ˆ

**è§£å†³æ–¹æ¡ˆ**:
1. æœåŠ¡ç«¯æ–½æ³•æ—¶ï¼Œå°† `JsonCastData` è®¾ç½®åˆ° `MagicData`
2. æ–½æ³•å®Œæˆåï¼Œé€šè¿‡ `ClientboundOnClientCast` åŒæ­¥
3. `JsonCastData` å®ç° `ICastDataSerializable`ï¼Œæ”¯æŒåºåˆ—åŒ–
4. å®¢æˆ·ç«¯ `onClientCast()` æ¥æ”¶ `ICastData`ï¼Œå¯è½¬æ¢ä¸º `SpellParameters`

**ä»£ç æµç¨‹**:
```java
// æœåŠ¡ç«¯
JsonCastData castData = new JsonCastData(params);
magicData.setAdditionalCastData(castData);
spell.onCastWithParameters(..., params);

// åŒæ­¥åˆ°å®¢æˆ·ç«¯
Messages.sendToPlayersTrackingEntity(
    new ClientboundOnClientCast(spell, level, castData),
    entity
);

// å®¢æˆ·ç«¯
@Override
public void onClientCast(Level level, int spellLevel, LivingEntity entity, ICastData castData) {
    if (castData instanceof JsonCastData jsonData) {
        SpellParameters params = jsonData.toSpellParameters();
        boolean showParticles = params.getBoolean("showParticles", true);
        if (showParticles) {
            // æ’­æ”¾ç²’å­
        }
    }
}
```

---

## 6. ä½¿ç”¨æ–‡æ¡£

### 6.1 å¿«é€Ÿå¼€å§‹

#### åŸºç¡€ç”¨æ³•
```bash
# 1. æ–½æ”¾æŠ€èƒ½ï¼ˆåŸæœ‰æ–¹å¼ï¼Œå®Œå…¨å…¼å®¹ï¼‰
/cast @s firebolt 5

# 2. æŸ¥çœ‹æŠ€èƒ½æ”¯æŒçš„å‚æ•°
/iss spells doc firebolt

# 3. ä½¿ç”¨å‚æ•°æ–½æ³•
/cast @s firebolt 5 {"damage": 100.0}
```

#### å¸¸è§å‚æ•°

**é€šç”¨å‚æ•°** (é€‚ç”¨äºå¤§éƒ¨åˆ†æŠ€èƒ½):
```json
{
  "consumeMana": false,        // ä¸æ¶ˆè€—é­”æ³•
  "triggerCooldown": false,    // ä¸è§¦å‘å†·å´
  "playEffects": true,         // æ’­æ”¾ç‰¹æ•ˆ
  "bypassConditions": false    // è·³è¿‡å‰ç½®æ¡ä»¶
}
```

**æŠ€èƒ½æ•ˆæœå‚æ•°** (æŠ€èƒ½ç‰¹å®š):
```json
// Firebolt
{"damage": 100.0, "fireTime": 10}

// Heal
{"healAmount": 50.0, "target": "uuid-here", "showParticles": false}

// Portal
{"targetPos": [100, 64, 200], "dimension": "minecraft:the_nether", "duration": 120}
```

### 6.2 é«˜çº§åº”ç”¨

#### åœºæ™¯ 1: PVP ç«æŠ€åœº
```bash
# è®¾ç½®ç»ƒä¹ æ¨¡å¼ï¼šä½ä¼¤å®³ã€æ— å†·å´
/cast @s firebolt 10 {"damage": 5.0, "triggerCooldown": false}
```

#### åœºæ™¯ 2: ä»»åŠ¡ç³»ç»Ÿ
```bash
# åœ¨ Function ä¸­ä½¿ç”¨
execute as @a[tag=quest_fire_master] run cast @s fireball 5 {"damage": 200.0, "consumeMana": false}
```

#### åœºæ™¯ 3: è°ƒè¯•æµ‹è¯•
```bash
# å¿«é€Ÿæµ‹è¯•ä¸åŒä¼¤å®³
/cast @s firebolt 5 {"damage": 10.0}
/cast @s firebolt 5 {"damage": 50.0}
/cast @s firebolt 5 {"damage": 100.0}
```

### 6.3 å‚æ•°ç±»å‹å‚è€ƒ

| ç±»å‹ | JSON æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ |
|------|-----------|------|------|
| INT | æ•°å­— | `10` | æ•´æ•° |
| FLOAT | æ•°å­— | `10.5` | æµ®ç‚¹æ•° |
| DOUBLE | æ•°å­— | `10.123456` | åŒç²¾åº¦ |
| STRING | å­—ç¬¦ä¸² | `"hello"` | æ–‡æœ¬ |
| BOOLEAN | å¸ƒå°” | `true` / `false` | çœŸ/å‡ |
| VEC3 | æ•°ç»„ | `[100, 64, 200]` | ä¸‰ç»´åæ ‡ |
| UUID | å­—ç¬¦ä¸² | `"abc-123-def"` | å®ä½“ UUID |
| DIMENSION | å­—ç¬¦ä¸² | `"minecraft:the_nether"` | ç»´åº¦ ID |

---

## 7. æµ‹è¯•è®¡åˆ’

### 7.1 å•å…ƒæµ‹è¯•

**æµ‹è¯•é¡¹ç›®**:
- `SpellParameters` JSON è§£æ
- `SpellParameterSchema` å‚æ•°æ ¡éªŒ
- `CastOptions` é€‰é¡¹åˆå¹¶
- `JsonCastData` åºåˆ—åŒ–/ååºåˆ—åŒ–

**æµ‹è¯•æ¡†æ¶**: JUnit 5

**ç¤ºä¾‹æµ‹è¯•ç”¨ä¾‹**:
```java
@Test
public void testJsonParsing() throws Exception {
    String json = "{\"damage\": 100.0, \"fireTime\": 10}";
    SpellParameters params = SpellParameters.fromJson(json);

    assertEquals(100.0f, params.getFloat("damage", 0), 0.01);
    assertEquals(10, params.getInt("fireTime", 0));
}

@Test
public void testParameterValidation() {
    // ç®¡ç†å‘˜è½¨é“ï¼šä»…åšç±»å‹å’Œå¿…å¡«æ ¡éªŒï¼Œæ— å€¼åŸŸé™åˆ¶
    SpellParameterSchema schema = SpellParameterSchema.builder()
        .required("damage", ParameterType.FLOAT, "ä¼¤å®³")
        // æ³¨æ„ï¼šç®¡ç†å‘˜è½¨é“ä¸ä½¿ç”¨ withRange() é™åˆ¶
        .build();

    SpellParameters validParams = SpellParameters.fromJson("{\"damage\": 50.0}");
    assertTrue(schema.validate(validParams).success);

    // ç±»å‹é”™è¯¯æ ¡éªŒ
    SpellParameters invalidParams = SpellParameters.fromJson("{\"damage\": \"abc\"}");
    assertFalse(schema.validate(invalidParams).success);

    // å¤§æ•°å€¼æµ‹è¯•ï¼ˆç®¡ç†å‘˜è½¨é“å…è®¸ï¼‰
    SpellParameters largeValueParams = SpellParameters.fromJson("{\"damage\": 9999999.0}");
    assertTrue(schema.validate(largeValueParams).success);
}
```

### 7.2 é›†æˆæµ‹è¯•

**æµ‹è¯•ç¯å¢ƒ**: Minecraft 1.20.1 å¼€å‘æœåŠ¡å™¨

**æµ‹è¯•çŸ©é˜µ**:

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•ç”¨ä¾‹ | é¢„æœŸç»“æœ |
|----------|----------|----------|
| åŸºç¡€å…¼å®¹ | `/cast @s firebolt 5` | æ­£å¸¸æ–½æ³•ï¼Œæ— é”™è¯¯ |
| JSON è§£æ | `/cast @s firebolt 5 {"damage": 100}` | ä¼¤å®³ä¸º 100 |
| ç±»å‹æ ¡éªŒ | `/cast @s firebolt 5 {"damage": "abc"}` | æç¤ºç±»å‹é”™è¯¯ |
| å¿…å¡«å‚æ•° | å®ç°å¿…å¡«å‚æ•°çš„æŠ€èƒ½ç¼ºå°‘å‚æ•° | æç¤ºç¼ºå°‘å‚æ•° |
| å¯é€‰å‚æ•° | ä¸æä¾›å¯é€‰å‚æ•° | ä½¿ç”¨é»˜è®¤å€¼ |
| æ— ä¸Šé™å€¼ | `/cast @s firebolt 5 {"damage": 9999999}` | æ­£å¸¸æ‰§è¡Œï¼ˆç®¡ç†å‘˜ç‰¹æƒï¼‰ |
| è¡Œä¸ºæ§åˆ¶ | `{"consumeMana": false}` | é»˜è®¤ä¸æ¶ˆè€—é­”æ³• |
| ç›®æ ‡æŒ‡å®š | `{"target": "uuid"}` | å¯¹æŒ‡å®šç›®æ ‡ç”Ÿæ•ˆ |
| æ–‡æ¡£ç”Ÿæˆ | `/iss spells export` | ç”Ÿæˆæ–‡æ¡£æ–‡ä»¶ |
| æ€§èƒ½æµ‹è¯• | è¿ç»­ 100 æ¬¡æ–½æ³• | TPS æ— æ˜æ˜¾ä¸‹é™ |

### 7.3 è¾¹ç•Œæµ‹è¯•

**æµ‹è¯•ç”¨ä¾‹**:
1. ç©º JSON: `{}`
2. è¶…é•¿ JSON: 1KB+ å‚æ•°
3. åµŒå¥— JSON: `{"data": {"nested": "value"}}`
4. ç‰¹æ®Šå­—ç¬¦: `{"name": "ç©å®¶\\\"åç§°"}`
5. æ— æ•ˆ UUID: `{"target": "invalid-uuid"}`
6. è¶…å¤§æ•°å€¼: `{"damage": 999999999}`
7. è´Ÿæ•°å€¼: `{"damage": -100}`

---

## 8. æ„å»ºä¸éƒ¨ç½²

### 8.1 æ„å»ºæµç¨‹

```bash
# 1. ç¯å¢ƒå‡†å¤‡
# ç¡®ä¿å®‰è£… JDK 17+
java -version

# 2. æ¸…ç†æ—§æ„å»º
gradlew clean

# 3. ç¼–è¯‘é¡¹ç›®
gradlew build

# 4. æ£€æŸ¥è¾“å‡º
# æŸ¥çœ‹ build/libs/ ç›®å½•
# åº”ç”Ÿæˆ: irons_spellbooks-1.20.1-x.x.x.jar
```

### 8.2 éƒ¨ç½²æ­¥éª¤

**å•æœºæµ‹è¯•**:
1. å¤åˆ¶ JAR åˆ° `.minecraft/mods/`
2. å¯åŠ¨æ¸¸æˆ
3. åŠ è½½å­˜æ¡£
4. æ‰§è¡Œæµ‹è¯•æŒ‡ä»¤

**æœåŠ¡å™¨éƒ¨ç½²**:
1. åœæ­¢æœåŠ¡å™¨
2. å¤‡ä»½åŸ Mod æ–‡ä»¶
3. æ›¿æ¢æ–°ç‰ˆæœ¬ JAR
4. å¯åŠ¨æœåŠ¡å™¨
5. æ£€æŸ¥æ—¥å¿—æ— é”™è¯¯
6. æ¸¸æˆå†…éªŒè¯åŠŸèƒ½

### 8.3 å›æ»šæ–¹æ¡ˆ

å¦‚é‡ä¸¥é‡é—®é¢˜ï¼Œæ‰§è¡Œä»¥ä¸‹æ­¥éª¤:
1. åœæ­¢æœåŠ¡å™¨/é€€å‡ºæ¸¸æˆ
2. æ¢å¤å¤‡ä»½çš„åŸç‰ˆ Mod
3. åˆ é™¤ `config/irons_spellbooks/spell_parameters.*` æ–‡ä»¶
4. é‡æ–°å¯åŠ¨
5. æŠ¥å‘Šé—®é¢˜æ—¥å¿—

---

## 9. é£é™©è¯„ä¼°ä¸ç¼“è§£

### 9.1 æŠ€æœ¯é£é™©

| é£é™©é¡¹ | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|--------|------|------|----------|
| JSON è§£ææ€§èƒ½ | ä¸­ | ä½ | ä½¿ç”¨ç¼“å­˜ï¼Œé™åˆ¶ JSON å¤§å° |
| å‚æ•°æ³¨å…¥æ”»å‡» | é«˜ | ä¸­ | ä¸¥æ ¼ç±»å‹æ ¡éªŒï¼ŒèŒƒå›´é™åˆ¶ |
| ç½‘ç»œåºåˆ—åŒ–å¤±è´¥ | ä¸­ | ä½ | å®Œå–„é”™è¯¯å¤„ç†ï¼Œå›é€€æœºåˆ¶ |
| å…¼å®¹æ€§ç ´å | é«˜ | ä½ | ä¿ç•™åŸæœ‰æ–¹æ³•ï¼Œæ¥å£å¯é€‰ |

### 9.2 ä¸šåŠ¡é£é™©

| é£é™©é¡¹ | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|--------|------|------|----------|
| ç”¨æˆ·å­¦ä¹ æˆæœ¬ | ä¸­ | é«˜ | è¯¦ç»†æ–‡æ¡£ï¼Œç¤ºä¾‹ä¸°å¯Œ |
| æ»¥ç”¨å‚æ•°ç ´åå¹³è¡¡ | é«˜ | ä¸­ | OP æƒé™é™åˆ¶ï¼ŒèŒƒå›´æ ¡éªŒ |
| æ–‡æ¡£ç»´æŠ¤æˆæœ¬ | ä¸­ | ä¸­ | è‡ªåŠ¨ç”Ÿæˆï¼Œå‡å°‘æ‰‹åŠ¨ç»´æŠ¤ |

---

## 10. åç»­æ‰©å±•è®¡åˆ’

### 10.1 çŸ­æœŸè®¡åˆ’ (1-2 å‘¨)

1. **æ‰©å±•æ›´å¤šæŠ€èƒ½**
   - ä¼˜å…ˆæ”¹é€ é«˜é¢‘ä½¿ç”¨æŠ€èƒ½
   - ç›®æ ‡: è¦†ç›– 30+ æŠ€èƒ½

2. **ä¼˜åŒ–æ–‡æ¡£ç”Ÿæˆ**
   - æ·»åŠ ä½¿ç”¨ç¤ºä¾‹
   - æ”¯æŒå¤šè¯­è¨€

3. **æ€§èƒ½ä¼˜åŒ–**
   - JSON è§£æç¼“å­˜
   - å‚æ•°æ ¡éªŒç»“æœç¼“å­˜

### 10.2 ä¸­æœŸè®¡åˆ’ (1-2 ä¸ªæœˆ)

1. **GUI é…ç½®ç•Œé¢**
   - å›¾å½¢åŒ–å‚æ•°ç¼–è¾‘å™¨
   - å®æ—¶é¢„è§ˆæ•ˆæœ

2. **å‚æ•°æ¨¡æ¿ç³»ç»Ÿ**
   - é¢„è®¾å¸¸ç”¨å‚æ•°ç»„åˆ
   - ä¸€é”®åº”ç”¨æ¨¡æ¿

3. **è„šæœ¬åŒ–æ”¯æŒ**
   - æ”¯æŒ JavaScript/Lua è„šæœ¬
   - åŠ¨æ€è®¡ç®—å‚æ•°å€¼

### 10.3 é•¿æœŸè®¡åˆ’ (3+ ä¸ªæœˆ)

1. **å‚æ•°åŒ– AI ç”Ÿç‰©**
   - æ”¯æŒç”Ÿç‰©æ–½æ³•å‚æ•°
   - éš¾åº¦åŠ¨æ€è°ƒæ•´

2. **æŠ€èƒ½é“¾ç³»ç»Ÿ**
   - è¿ç»­æŠ€èƒ½ç»„åˆ
   - å‚æ•°ä¼ é€’é“¾

3. **äº‘é…ç½®åŒæ­¥**
   - æœåŠ¡å™¨å‚æ•°é…ç½®äº‘ç«¯å­˜å‚¨
   - å¤šæœåŠ¡å™¨åŒæ­¥

---

## é™„å½•

### A. é”™è¯¯ç å‚è€ƒ

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|
| PARAM_001 | JSON è§£æå¤±è´¥ | æ£€æŸ¥ JSON è¯­æ³• |
| PARAM_002 | å‚æ•°ç±»å‹é”™è¯¯ | æ£€æŸ¥å‚æ•°ç±»å‹å®šä¹‰ |
| PARAM_003 | ç¼ºå°‘å¿…å¡«å‚æ•° | è¡¥å……å¿…å¡«å‚æ•° |
| PARAM_004 | å‚æ•°å€¼è¶…å‡ºèŒƒå›´ | è°ƒæ•´å‚æ•°å€¼ |
| SPELL_001 | æŠ€èƒ½ä¸å­˜åœ¨ | æ£€æŸ¥æŠ€èƒ½ ID |
| SPELL_002 | æŠ€èƒ½ä¸æ”¯æŒå‚æ•°åŒ– | ä½¿ç”¨åŸæœ‰æŒ‡ä»¤æ ¼å¼ |

### B. å¼€å‘è§„èŒƒ

**å‘½åè§„èŒƒ**:
- ç±»å: å¤§é©¼å³° `SpellCastManager`
- æ–¹æ³•å: å°é©¼å³° `castSpell()`
- å˜é‡å: å°é©¼å³° `spellParameters`
- å¸¸é‡å: å…¨å¤§å†™ä¸‹åˆ’çº¿ `MAX_DAMAGE`

**æ³¨é‡Šè§„èŒƒ**:
- æ‰€æœ‰å…¬å¼€ API å¿…é¡»æœ‰ JavaDoc
- å¤æ‚é€»è¾‘å¿…é¡»æœ‰è¡Œå†…æ³¨é‡Š
- æ³¨é‡Šä½¿ç”¨ä¸­æ–‡

**å¼‚å¸¸å¤„ç†**:
- æ•è·å…·ä½“å¼‚å¸¸ç±»å‹
- è®°å½•è¯¦ç»†æ—¥å¿—
- å‘ç”¨æˆ·æä¾›å‹å¥½æç¤º

### C. å‚è€ƒèµ„æ–™

1. Minecraft Forge æ–‡æ¡£: https://docs.minecraftforge.net/
2. Brigadier æŒ‡ä»¤ç³»ç»Ÿ: https://github.com/Mojang/brigadier
3. Gson JSON åº“: https://github.com/google/gson
4. é“é­”æ³•åŸç‰ˆä»“åº“: https://github.com/iron431/irons-spells-n-spellbooks

---

**æ–‡æ¡£ç»“æŸ**

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚
